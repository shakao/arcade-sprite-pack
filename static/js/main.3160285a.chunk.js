(this["webpackJsonparcade-sprite-pack"]=this["webpackJsonparcade-sprite-pack"]||[]).push([[0],{18:function(e,t,a){e.exports=a(39)},23:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){},30:function(e,t,a){},31:function(e,t,a){},32:function(e,t,a){},33:function(e,t,a){},34:function(e,t,a){},35:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){"use strict";a.r(t);var n,r=a(0),i=a.n(r),s=a(16),o=a.n(s),c=(a(23),a(4)),l=a(9),u=a(12),p=a(3),d=a(5),f=a(6),m=a(11),h=a(10),v=a(1),g=a.n(v),b=a(2);function w(e){return e?new Promise((function(t,a){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(new Uint8Array(n.result))},n.readAsArrayBuffer(e)})):Promise.resolve(null)}var x=["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],y="image",k="tile",A="tilemap",E="animation";function C(){return n||T(),n}function T(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n=new pxt.TilemapProject,x=["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],!e){var t=window.localStorage.getItem("tilemap-project");if(t){var a=JSON.parse(t);n.loadAssetsJRes(a.images),n.loadTilemapJRes(a.tilemaps)}}return n}function N(){return x.slice()}function j(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream",n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return O(btoa(R(e)),t,a,n,r)}function I(e,t){if(navigator&&/Edge/i.test(navigator.userAgent)||navigator&&/Trident/i.test(navigator.userAgent)){var a=D(atob(e.split(",")[1])),n=new Blob([a],{type:"img/png"});window.navigator.msSaveOrOpenBlob(n,t)}else{var r=window.document.createElement("a");"string"==typeof r.download?(r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)):document.location.href=e}}function O(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream",n=arguments.length>4?arguments[4]:void 0,r=window.navigator.msSaveOrOpenBlob,i=S(e,t);try{if(r){var s=new Blob([D(atob(e))],{type:a});window.navigator.msSaveOrOpenBlob(s,t)}else I(i,t)}catch(o){n&&n(o)}return i}function S(e,t){return"data:"+t+";base64,"+e}function D(e){for(var t=e.length,a=new Uint8Array(t),n=0;n<t;++n)a[n]=255&e.charCodeAt(n);return a}function R(e){for(var t=e.length,a="",n=0;n<t;++n)a+=String.fromCharCode(e[n]);return a}var F=function(){function e(){Object(d.a)(this,e),this.palette=null,this.start=0}return Object(f.a)(e,[{key:"logTime",value:function(){if(this.start){var e=Date.now()-this.start;pxt.debug("Icon creation: "+e+"ms")}}},{key:"convert",value:function(e){this.start||(this.start=Date.now());var t=atob(e.slice(e.indexOf(",")+1)),a=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2);if(135===a&&(a=224|t.charCodeAt(1),n=t.charCodeAt(2)|t.charCodeAt(3)<<8,r=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4)),225!=a&&228!=a)return null;if(!this.palette){var i=N().map((function(e){var t=parseInt(e.replace(/#/,""),16);return[t>>0&255,t>>8&255,t>>16&255,255]}));i[0][3]=0,this.palette=new Uint8Array(4*i.length);for(var s=0;s<i.length;++s)this.palette[4*s+0]=i[s][0],this.palette[4*s+1]=i[s][1],this.palette[4*s+2]=i[s][2],this.palette[4*s+3]=i[s][3]}if(225==a)return this.genMonochrome(t,n,r);var o=(pxt.BrowserUtils.isEdge()||pxt.BrowserUtils.isIE())&&n<100&&r<100?3:1;return this.genColor(t,n,r,o)}},{key:"genMonochrome",value:function(e,t,a){var n=t+3&-4,r=54+this.palette.length,i=r+n*a,s=new Uint8Array(i);s[0]=66,s[1]=77,pxt.HF2.write32(s,2,i),pxt.HF2.write32(s,10,r),pxt.HF2.write32(s,14,40),pxt.HF2.write32(s,18,t),pxt.HF2.write32(s,22,-a),pxt.HF2.write16(s,26,1),pxt.HF2.write16(s,28,8),pxt.HF2.write32(s,38,2835),pxt.HF2.write32(s,42,2835),pxt.HF2.write32(s,46,this.palette.length>>2),s.set(this.palette,54);for(var o=4,c=r,l=1,u=e.charCodeAt(o++),p=0;p<t;++p){c=r+p;for(var d=0;d<a;++d)s[c]=u&l?1:0,c+=n,256==(l<<=1)&&(l=1,u=e.charCodeAt(o++))}return"data:image/bmp;base64,"+btoa(pxt.U.uint8ArrayToString(s))}},{key:"genColor",value:function(e,t,a,n){var r=t*(n=Math.max(1,0|n)),i=a*n,s=r<<2,o=138+s*i,c=new Uint8Array(o);c[0]=66,c[1]=77,pxt.HF2.write32(c,2,o),pxt.HF2.write32(c,10,138),pxt.HF2.write32(c,14,124),pxt.HF2.write32(c,18,r),pxt.HF2.write32(c,22,-i),pxt.HF2.write16(c,26,1),pxt.HF2.write16(c,28,32),pxt.HF2.write16(c,30,3),pxt.HF2.write32(c,38,2835),pxt.HF2.write32(c,42,2835),pxt.HF2.write32(c,54,16711680),pxt.HF2.write32(c,58,65280),pxt.HF2.write32(c,62,255),pxt.HF2.write32(c,66,4278190080),c[70]=66,c[71]=71,c[72]=82,c[73]=115;for(var l=4,u=138,p=!0,d=0;d<r;d++){var f=!1;u=138+(d<<2);for(var m=l,h=e.charCodeAt(l++),v=f?(h>>4&15)<<2:(15&h)<<2,g=0;g<i;g++)h&&(p=!1),c[u]=this.palette[v],c[u+1]=this.palette[v+1],c[u+2]=this.palette[v+2],c[u+3]=this.palette[v+3],u+=s,g%n===n-1&&(f&&(h=e.charCodeAt(l++)),v=(f=!f)?(h>>4&15)<<2:(15&h)<<2);if(p&&(c[141]=1),d%n===n-1)for(a%2||--l;3&l;)l++;else l=m}return"data:image/bmp;base64,"+btoa(pxt.U.uint8ArrayToString(c))}}]),e}();function H(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F;switch(e.type){case y:case k:return e.previewURI=a.convert("data:image/x-mkcd-f,"+e.jresData),e;case A:var n=e;return e.previewURI=P(n.data,Math.max(n.data.tilemap.width,n.data.tilemap.height),!1),e;case E:var r=e;return(null===(t=r.frames)||void 0===t?void 0:t.length)<=0?null:(r.framePreviewURIs=r.frames.map((function(e){return a.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e))})),e.previewURI=r.framePreviewURIs[0],e)}}function P(e,t,a){var n=N(),r=document.createElement("canvas");r.width=t,r.height=t;var i,s=Math.min(t/e.tilemap.width,t/e.tilemap.height),o=Math.max(Math.floor(t*(1-e.tilemap.width/e.tilemap.height)/2),0),c=Math.max(Math.floor(t*(1-e.tilemap.height/e.tilemap.width)/2),0);a?((i=r.getContext("2d",{alpha:!1})).fillStyle="#dedede",i.fillRect(0,0,t,t)):i=r.getContext("2d");for(var l=[],u=0;u<e.tilemap.width;u++)for(var p=0;p<e.tilemap.height;p++){var d=e.tilemap.get(u,p);if(d){if(!l[d]){var f=e.tileset.tiles[d];l[d]=f?pxt.sprite.computeAverageColor(pxt.sprite.Bitmap.fromData(f.bitmap),n):"#dedede"}i.fillStyle=l[d],i.fillRect(o+u*s,c+p*s,s,s)}else a&&(i.fillStyle="#dedede",i.fillRect(o+u*s,c+p*s,s,s))}return r.toDataURL()}function L(e){return M.apply(this,arguments)}function M(){return(M=Object(b.a)(g.a.mark((function e(t){var a,n,r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t);case 2:if(a=e.sent,(n=document.createElement("canvas")).width=a.width,n.height=a.height,r=n.getContext("2d")){e.next=9;break}return e.abrupt("return",null);case 9:return r.drawImage(a,0,0),i=r.getImageData(0,0,n.width,n.height),e.abrupt("return",{width:i.width,height:i.height,pixels:i.data});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return B.apply(this,arguments)}function B(){return(B=Object(b.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var a=document.createElement("img");a.src=t,a.onload=function(){e(a)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t){return G.apply(this,arguments)}function G(){return(G=Object(b.a)(g.a.mark((function e(t,a){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=btoa(R(t)),e.next=3,L("data:image/png;base64,"+n);case 3:if(!(r=e.sent)){e.next=6;break}return e.abrupt("return",W(r,a));case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){var a=_(t);return function(e,t,a){for(var n="img`\n    ",r=0;r<t;r++){for(var i=[],s=0;s<e;s++)i.push(a(s,r));n+=i.map((function(e){return e.toString(16)})).join(" "),n+="\n    "}return n+="`"}(e.width,e.height,(function(t,n){var r=n*e.width+t;return V(e.pixels,r<<2,a)}))}function _(e){for(var t=[],a=0;a<e.length;a++){var n=Q(e[a]);t.push([Z(n),q(n),z(n)])}return t}function Y(e){return e*e}function V(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(n&&e[t+3]<100)return 0;for(var r=0,i=-1,s=n?1:0;s<a.length;++s){var o=Y(a[s][0]-e[t+0])+Y(a[s][1]-e[t+1])+Y(a[s][2]-e[t+2]);(i<0||o<r)&&(i=s,r=o)}return i}function Z(e){return e>>16&255}function q(e){return e>>8&255}function z(e){return 255&e}function Q(e){if(e){if(6===e.length)return parseInt("0x"+e);if(7===e.length)return parseInt("0x"+e.substr(1))}return 0}var X="https://makecode.com/api";function K(e){return $.apply(this,arguments)}function $(){return($=Object(b.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return-1!==(a=t.trim()).indexOf("/")&&(a=a.substr(a.lastIndexOf("/")+1)),e.next=4,ae(X+"/"+a);case 4:return e.sent,e.next=7,ae(X+"/"+a+"/text");case 7:ee(e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){var t=e["pxt.json"];N();if(t)try{var a=JSON.parse(t);(null===a||void 0===a?void 0:a.palette)&&Array.isArray(a.palette)&&(a.palette.slice(),!0)}catch(c){}for(var n=C(),r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];if(s.endsWith(".jres")){var o=JSON.parse(e[s]);-1!==s.indexOf("tilemap")?n.loadTilemapJRes(o):n.loadAssetsJRes(o)}else s.endsWith(".ts")&&!s.endsWith(".g.ts")&&te(e[s])}}function te(e){var t=C();e.replace(/img\s*`[\s\da-f.#tngrpoyw]*`/gim,(function(e){var a=pxt.sprite.imageLiteralToBitmap(e);return t.createNewProjectImage(a.data(),function(e){switch(e){case y:return lf("myImage");case k:return lf("myTile");case A:return lf("level");case E:return lf("myAnim");default:return lf("asset")}}(y)),""}))}function ae(e){return new Promise((function(t,a){var n=new XMLHttpRequest;n.addEventListener("error",(function(e){a(e)})),n.addEventListener("load",(function(){try{t(JSON.parse(n.responseText))}catch(e){a(e)}})),n.open("GET",e),n.send()}))}var ne=a(13);function re(e){var t=ne.LZMA;return new Promise((function(a,n){try{t.compress(e,7,(function(e,t){t?n(t):a(new Uint8Array(e))}))}catch(r){n(r)}}))}function ie(e){var t=ne.LZMA;return new Promise((function(a,n){try{t.decompress(e,(function(e,t){t?n(t):a(e)}))}catch(r){n(r)}}))}a(28);var se=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).importInputRef=void 0,n.dragInit=!1,n.handleImportInputRef=function(e){e&&(n.importInputRef=e)},n.onImportDragEnter=function(e){n.setState({dragging:!0})},n.onImportDragLeave=function(e){n.setState({dragging:!1})},n.handleDropRef=function(e){var t,a,r;n.dragInit||(n.dragInit=!0,t=document.body,a=function(e){return!0},r=function(){var e=Object(b.a)(g.a.mark((function e(t){var a,r,i,s,o,c,l,u,d,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Object(p.a)(t),e.prev=1,a.s();case 3:if((r=a.n()).done){e.next=31;break}if(i=r.value,s=i.name.lastIndexOf("."),o=i.name.substr(s),c=i.name.slice(0,s),".png"!==o.toLowerCase()){e.next=20;break}return e.next=11,w(i);case 11:if(!(l=e.sent)){e.next=18;break}return e.next=15,U(l,N());case 15:(u=e.sent)&&C().createNewProjectImage(pxt.sprite.imageLiteralToBitmap(u).data(),c),n.props.onClose&&n.props.onClose();case 18:e.next=29;break;case 20:if(".mkcd"!==o.toLowerCase()){e.next=29;break}return e.next=23,w(i);case 23:if(!(d=e.sent)){e.next=29;break}return e.next=27,ie(d);case 27:f=e.sent;try{m=JSON.parse(f),ee(JSON.parse(m.source)),n.props.onClose&&n.props.onClose()}catch(h){}case 29:e.next=3;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(1),a.e(e.t0);case 36:return e.prev=36,a.f(),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[1,33,36,39]])})));return function(t){return e.apply(this,arguments)}}(),t.addEventListener("paste",(function(e){if(e.clipboardData){for(var t=[],n=0;n<e.clipboardData.files.length;n++)e.clipboardData.files.item(n)&&t.push(e.clipboardData.files.item(n));if((t=t.filter(a)).length>0)e.stopPropagation(),e.preventDefault(),r(t);else if(e.clipboardData.items&&e.clipboardData.items.length>0){var i=e.clipboardData.items[0].getAsFile();i&&(e.stopPropagation(),e.preventDefault(),r([i]))}}})),t.addEventListener("dragover",(function(e){if(e.dataTransfer){for(var t=e.dataTransfer.types,a=!1,n=0;n<t.length;++n)"Files"===t[n]&&(a=!0);if(a)return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!1}return!0}),!1),t.addEventListener("drop",(function(e){if(e.dataTransfer){for(var t=[],a=0;a<e.dataTransfer.files.length;a++)e.dataTransfer.files.item(a)&&t.push(e.dataTransfer.files.item(a));t.length>0&&(e.stopPropagation(),e.preventDefault(),r(t))}return!1}),!1),t.addEventListener("dragend",(function(e){return!1}),!1))},n.state={dragging:!1},n}return Object(f.a)(a,[{key:"onAlertClick",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"render",value:function(){var e=this;if(!this.props.visible)return i.a.createElement("div",null);var t=this.props,a=t.title,n=t.text,r=t.icon,s=t.options,o=t.onClose,c=t.type,l=this.state.dragging;return i.a.createElement("div",{className:"alert-container",onClick:o},i.a.createElement("div",{className:"alert",onClick:this.onAlertClick},i.a.createElement("div",{className:"alert-title"},r&&i.a.createElement("i",{className:"alert-icon icon ".concat(r)}),i.a.createElement("span",null,a),i.a.createElement("i",{className:"icon delete",onClick:o})),i.a.createElement("div",{className:"alert-text"},n),"import"===c&&i.a.createElement("div",{className:"asset-import"},i.a.createElement("div",{className:"asset-drop ".concat(l?"dragging":""),ref:this.handleDropRef,onDragEnter:this.onImportDragEnter,onDragLeave:this.onImportDragLeave},"Drop PNG files here to import."),i.a.createElement("input",{ref:this.handleImportInputRef,placeholder:"https://makecode.com/_r8fboJQTDPtH or https://arcade.makeode.com/62736-71128-62577-28722"})),"scale"===c&&i.a.createElement("div",{className:"asset-import"},i.a.createElement("input",{ref:this.handleImportInputRef,placeholder:"1"})),"tileset"===c&&i.a.createElement("div",{className:"asset-import"},i.a.createElement("input",{ref:this.handleImportInputRef,placeholder:"CustomTiles"})),s&&i.a.createElement("div",{className:"alert-options"},s.map((function(t,a){return i.a.createElement("div",{key:a,onClick:function(){var a;t.onClick(null===(a=e.importInputRef)||void 0===a?void 0:a.value),o&&o()},style:t.style},t.text)})))))}}]),a}(i.a.Component),oe=(a(29),a(30),function(e){var t=e.asset,a=e.selected,n=e.onClick,s=Object(r.useState)(0),o=Object(c.a)(s,2),l=o[0],u=o[1],p=C();p.addChangeListener(t,(function e(){u(l+1),p.removeChangeListener(t.type,e)}));var d=p.lookupAsset(t.type,t.id);return H(d),i.a.createElement("div",{className:"asset-preview ".concat(a?"selected":""),onClick:function(){return n(d)}},i.a.createElement("img",{src:d.previewURI}))}),ce=(a(31),a(32),function(e){var t=e.label,a=e.title,n=e.onClick;return i.a.createElement("button",{className:"asset-details-button",title:a,onClick:n},t)}),le=function(e){var t=e.activeTab,a=e.asset,s=e.onAssetSelected,o=C(),l=o.getAssets(t);l.sort(ue);var u="";switch(t){case y:u="Images";break;case k:u="Tiles";break;case E:u="Animations";break;case A:u="Tilemaps"}var p=Object(r.useState)(0),d=Object(c.a)(p,2),f=(d[0],d[1]),m=pxt.Util.debounce((function(){!function(){if(n){var e={images:n.getProjectAssetsJRes(),tilemaps:n.getProjectTilesetJRes()};window.localStorage.setItem("tilemap-project",JSON.stringify(e))}}()}),500);return o.addProjectChangeListener((function e(t){f(t),m(),o.removeProjectChangeListener(e)})),i.a.createElement("div",{className:"asset-list-container"},i.a.createElement("div",{className:"asset-details-header"},"All ",u),i.a.createElement("div",{className:"asset-list-outer"},i.a.createElement("div",{className:"asset-list"},l.map((function(e){return i.a.createElement(oe,{key:e.internalID,asset:e,selected:e.id==a.id,onClick:s})})),i.a.createElement(ce,{label:"Create New",title:"Create New Asset",onClick:function(){s(function(e){var t,a=C();switch(e){case y:t=a.createNewImage(16,16);break;case k:t=a.createNewTile(new pxt.sprite.Bitmap(16,16).data());break;case E:t=a.createNewAnimation(16,16);break;case A:var n=a.createNewTilemap("level",16,16),r=Object(c.a)(n,2),i=r[0];r[1];t=a.lookupAsset(A,i)}t.meta.displayName||(t.meta.displayName=pxt.getDefaultAssetDisplayName(e),a.updateAsset(t),t=a.lookupAsset(t.type,t.id));return t}(t))}}))))};function ue(e,t){return e.internalID-t.internalID}a(33);var pe=function(e){var t=e.items,a=e.selectedId,n=e.onItemSelected,s=Object(r.useState)(!1),o=Object(c.a)(s,2),l=o[0],u=o[1],p=t.find((function(e){return e.id===a}));return i.a.createElement("div",{className:"dropdown ".concat(l?"open":""),onClick:function(){return u(!l)}},i.a.createElement("span",{className:"dropdown-title"},null===p||void 0===p?void 0:p.label),i.a.createElement("i",{className:"icon caret down"}),l&&i.a.createElement("div",{className:"dropdown-menu"},t.map((function(e){return i.a.createElement("div",{key:e.id,className:"dropdown-menu-item ".concat(e.id===a?"selected":""),onClick:function(){return n(e.id)}},e.label)}))))},de=(a(34),[{id:"8",label:"8x8"},{id:"16",label:"16x16"},{id:"32",label:"32x32"}]),fe=function(e){var t=e.asset,a=e.showAlert,n=e.onAssetSelected,r=t.type===k||t.type===A;return i.a.createElement("div",{className:"asset-details"},i.a.createElement("div",{className:"asset-details-header"},"Asset Options"),i.a.createElement("div",{className:"asset-details-parameters"},r&&i.a.createElement("div",{className:"asset-details-key-value"},i.a.createElement("div",{className:"asset-details-key"},"Tile Size:"),i.a.createElement(pe,{items:de,onItemSelected:function(e){var r=C().lookupAsset(t.type,t.id),i=parseInt(e),s=!1;if(r.type===k){var o=r;s=!he(o.bitmap)&&i<o.bitmap.width}else s=!function(e){if(!he(e.layers))return!1;for(var t=e.tilemap,a=0;a<t.width;a++)for(var n=0;n<t.height;n++)if(t.get(a,n))return!1;return!0}(r.data);s?a({icon:"exclamation triangle",title:"WARNING",text:"This will erase the contents of the current asset. This cannot be undone. Do you want to continue?",options:[{text:"Yes",style:{backgroundColor:"#dc3f34"},onClick:function(){ve(r,i),n(r)}}]}):(ve(r,i),n(r))},selectedId:""+me(t)})),i.a.createElement(ce,{label:"Duplicate",title:"Create a copy of this asset",onClick:function(){var e=C().duplicateAsset(t);H(e),n(e)}}),i.a.createElement(ce,{label:"Delete",title:"Delete this asset",onClick:function(){a({icon:"exclamation triangle",title:"WARNING",text:"This will delete this asset. This cannot be undone. Do you want to continue?",options:[{text:"Yes",style:{backgroundColor:"#dc3f34"},onClick:function(){C().removeAsset(t),n(null)}}]})}})))};function me(e){return e.type===A?e.data.tileset.tileWidth:e.type===k?e.bitmap.width:void 0}function he(e){for(var t=pxt.sprite.Bitmap.fromData(e),a=0;a<e.width;a++)for(var n=0;n<e.height;n++)if(t.get(a,n))return!1;return!0}function ve(e,t){var a=C();if(e.type===k){var n=e,r=pxt.sprite.Bitmap.fromData(n.bitmap),i=new pxt.sprite.Bitmap(t,t);i.apply(r),n.bitmap=i.data()}else{var s=e,o=new pxt.sprite.Tilemap(s.data.tilemap.width,s.data.tilemap.height),c=new pxt.sprite.Bitmap(s.data.tilemap.width,s.data.tilemap.height),l=new pxt.sprite.TilemapData(o,{tileWidth:t,tiles:[a.getTransparency(t)]},c.data());s.data=l}H(e),a.updateAsset(e)}var ge=function(e){var t=e.showAlert,a=e.activeTab,n=e.asset,r=e.onAssetSelected;return i.a.createElement("div",{className:"asset-sidebar"},i.a.createElement("div",{className:"asset-details-container"},i.a.createElement(fe,{asset:n,showAlert:t,onAssetSelected:r})),i.a.createElement(le,{activeTab:a,asset:n,onAssetSelected:r}))},be=(a(35),a(17));function we(e){var t={name:e,dependencies:{device:"*"},description:"An asset pack for MakeCode Arcade",files:["main.blocks","main.ts"],testFiles:["test.ts"]},a={},n=C(),r=n.getProjectTilesetJRes();if(Object.keys(r).length>1){var i=JSON.stringify(r,null,4),s=pxt.emitTilemapsFromJRes(r);a["tilemap.g.jres"]=i,a["tilemap.g.ts"]=s,t.files.push("tilemap.g.jres"),t.files.push("tilemap.g.ts")}var o=n.getProjectAssetsJRes();if(Object.keys(o).length>1){var c=JSON.stringify(o,null,4),l=pxt.emitProjectImages(o);a["images.g.jres"]=c,a["images.g.ts"]=l,t.files.push("images.g.jres"),t.files.push("images.g.ts")}a["pxt.json"]=JSON.stringify(t,null,4),a["main.ts"]='/*\n * This project was created using arcade-sprite-pack. If you\n * want to publish this project to GitHub as a sprite pack, do\n * not add any code to this file! The code that is running in the\n * simulator can be edited by clicking on the file explorer to the\n * left and selecting "test.ts". Any code added to "test.ts" will\n * not be added to a project that imports this sprite pack as an\n * extension.\n *\n * If you don\'t wish to publish this project, you can use this project\n * as-is. Your sprites should show up in the sprite gallery. Make sure\n * you delete the code in "test.ts"!\n *\n *\n * To publish this project to GitHub:\n *   1. Rename this project to something descriptive\n *   2. Click the GitHub button in the bottom bar next to the save\n *      button (sign in to GitHub if prompted)\n *   3. Choose a name for your repository. This is the name that\n *      people will see when importing your project.\n *   4. Make sure "public repository" is selected in the dropdown\n *      if you want other people to be able to use your sprites\n *   5. Click "go ahead"\n *   6. If you are on a shared computer, make sure you sign out of\n *      GitHub!\n *\n *\n * To add a published project to an Arcade project:\n *   1. Inside the MakeCode editor, click "Extensions" under "Advanced"\n *      in the toolbox\n *   2. Inside the search box that appears, type your GitHub username\n *      followed by a "/" and the name of the repository. It should\n *      look something like this: username/repository\n *   3. Hit enter on your keyboard and click the card that appears\n *   4. The sprites should now show up in the gallery of the sprite\n *      editor (at the bottom)\n * */\n',a["test.ts"]="",a["README.md"]="",a["main.blocks"]='<xml xmlns="http://www.w3.org/1999/xhtml"><variables></variables><block type="pxt-on-start" x="0" y="0"></block></xml>';var u={meta:{cloudId:"pxt/arcade",targetVersions:{},name:e,editor:"tsprj"},source:JSON.stringify(a)};return re(JSON.stringify(u))}function xe(){return(xe=Object(b.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we(t);case 2:return a=e.sent,e.abrupt("return",j(a,t+".mkcd"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){return(ye=Object(b.a)(g.a.mark((function e(t){var a,n,r,i,s,o,c,l,u,d,f,m,h,v,b,w,x,A,T,j,O,S;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=C(),n=[],r=Object(p.a)(a.getAssets(y));try{for(r.s();!(i=r.n()).done;)s=i.value,n.push(pxt.sprite.Bitmap.fromData(s.bitmap))}catch(g){r.e(g)}finally{r.f()}o=Object(p.a)(a.getAssets(k));try{for(o.s();!(c=o.n()).done;)l=c.value,n.push(pxt.sprite.Bitmap.fromData(l.bitmap))}catch(g){o.e(g)}finally{o.f()}u=Object(p.a)(a.getAssets(E));try{for(u.s();!(d=u.n()).done;)f=d.value,n.push.apply(n,Object(be.a)(f.frames.map((function(e){return pxt.sprite.Bitmap.fromData(e)}))))}catch(g){u.e(g)}finally{u.f()}for(m=document.createElement("canvas"),h=N(),v=[],b=0,w=n;b<w.length;b++){for(x=w[b],m.width=x.width*t,m.height=x.height*t,A=m.getContext("2d"),T=0;T<x.width;T++)for(j=0;j<x.height;j++)(O=x.get(T,j))?(A.fillStyle=h[O],A.fillRect(T*t,j*t,t,t)):A.clearRect(T*t,j*t,t,t);v.push(m.toDataURL())}for(S=0;S<v.length;S++)I(v[S],"image"+S+".png");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t}function Ae(){return(Ae=Object(b.a)(g.a.mark((function e(t){var a,n,r,i,s,o,c,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=C(),n=a.getAssets(E),r=N(),s=function(e){var t=ke(e);if(i=e,!r.some((function(e){return e.toLowerCase()===t.toLowerCase()})))return"break"},o=0;case 5:if(!(o<17)){e.next=12;break}if("break"!==s(o)){e.next=9;break}return e.abrupt("break",12);case 9:o++,e.next=5;break;case 12:return e.next=14,Promise.all(n.map(function(){var e=Object(b.a)(g.a.mark((function e(a){var n,s,o,c,l,u,d,f,m,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new GIF({workers:2,quality:1,transparent:i}),s=Object(p.a)(a.frames);try{for(s.s();!(o=s.n()).done;){for(c=o.value,(l=document.createElement("canvas")).width=c.width*t,l.height=c.height*t,(u=l.getContext("2d")).clearRect(0,0,l.width,l.height),d=pxt.sprite.Bitmap.fromData(c),f=0;f<d.width;f++)for(m=0;m<d.height;m++)(h=d.get(f,m))?(u.fillStyle=r[h],u.fillRect(f*t,m*t,t,t)):(u.fillStyle=ke(i),u.fillRect(f*t,m*t,t,t));n.addFrame(l,{delay:a.interval})}}catch(v){s.e(v)}finally{s.f()}return e.abrupt("return",Ee(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:for(c=e.sent,l=0;l<c.length;l++)I(URL.createObjectURL(c[l]),"animation"+l+".gif");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return new Promise((function(t,a){e.on("finished",(function(e,a){t(e)})),e.on("abort",a),e.render()}))}function Ce(){return(Ce=Object(b.a)(g.a.mark((function e(t){var a,n,r,i,s,o,c,l,u,p,d,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={name:t,dependencies:{device:"*"},description:"An asset pack for MakeCode Arcade",files:["tiles.jres","tiles.ts"],testFiles:[]},n={},r=C(),i=r.getProjectTilesetJRes(),s="customTiles_"+t,i["*"].namespace=s,o="",c=0,l=Object.keys(i);case 8:if(!(c<l.length)){e.next=24;break}if("*"!==(u=l[c])){e.next=12;break}return e.abrupt("continue",21);case 12:if((p=i[u]).mimeType!==pxt.TILEMAP_MIME_TYPE){e.next=16;break}return delete i[u],e.abrupt("continue",21);case 16:d=u,0===u.indexOf("myTiles.")&&(delete i[u],d=s+"."+u.split(".")[1],i[d]=p),o+="    //% fixedInstance jres blockIdentity=images._tile\n",o+='    //% tags="tile category-'.concat(t,'"\n'),o+="    export const ".concat(u," = image.ofBuffer(hex``);\n");case 21:c++,e.next=8;break;case 24:return o="namespace ".concat(s," {\n").concat(o,"}\n"),n["pxt.json"]=JSON.stringify(a,null,4),n["tiles.ts"]=o,n["tiles.jres"]=JSON.stringify(i,null,4),f={meta:{cloudId:"pxt/arcade",targetVersions:{},name:t,editor:"tsprj"},source:JSON.stringify(n)},e.next=31,re(JSON.stringify(f));case 31:return m=e.sent,e.abrupt("return",j(m,t+".mkcd"));case 33:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Te=function(e){return i.a.createElement("div",{className:"asset-list-buttons"},i.a.createElement("div",{className:"asset-button",title:"Clear all assets",onClick:function(){return function(e){(0,e.showAlert)({icon:"exclamation triangle",title:"WARNING",text:"This will delete ALL assets in this project. You will not be able to undo this action.",options:[{text:"Delete All",style:{backgroundColor:"#dc3f34"},onClick:function(){T(!0)}}]})}(e)}},i.a.createElement("i",{className:"icon delete"})),i.a.createElement("div",{className:"asset-button",title:"Import assets",onClick:function(){return function(e){(0,e.showAlert)({icon:"upload",type:"import",title:"Import Sprites",text:"Paste a URL from MakeCode Arcade or drag and drop PNG files to import existing sprites.",options:[{text:"Add to project",onClick:function(e){e&&K(e)}},{text:"Overwrite project",onClick:function(e){e&&(T(!0),K(e))}}]})}(e)}},i.a.createElement("i",{className:"icon upload"})),i.a.createElement("div",{className:"asset-button",title:"Export assets",onClick:function(){return function(e){var t=e.showAlert;t({icon:"download",title:"Export",text:"Choose export method",options:[{text:"Export .mkcd file",onClick:function(e){!function(e){xe.apply(this,arguments)}("project")}},{text:"Export tileset .mkcd file",onClick:function(e){setTimeout((function(){t({icon:"download",title:"Download Tileset",text:"Enter a name for the tileset category. Only letters and numbers are allowed (no spaces).",type:"tileset",options:[{text:"download",onClick:function(e){var t;!function(e){Ce.apply(this,arguments)}(e=(null===(t=e)||void 0===t?void 0:t.replace(/[^a-zA-Z\d]/,""))||"CustomTiles")}}]})}))}},{text:"Export PNGs",onClick:function(e){setTimeout((function(){t({type:"scale",icon:"download",title:"Export PNGs",text:"Enter scale factor",options:[{text:"Export",onClick:function(e){!function(e){ye.apply(this,arguments)}(e?parseInt(e):1)}}]})}),100)}},{text:"Export animations as GIFs",onClick:function(e){setTimeout((function(){t({type:"scale",icon:"download",title:"Export animations as GIFs",text:"Enter scale factor",options:[{text:"Export",onClick:function(e){!function(e){Ae.apply(this,arguments)}(e?parseInt(e):1)}}]})}),100)}}]})}(e)}},i.a.createElement("i",{className:"icon download"})))};a(36);var Ne=function(e){var t=e.options,a=e.onTabSelected,n=e.activeTab;return i.a.createElement("div",{className:"asset-tab-bar"},t.map((function(e){var t=e.type,r=e.name,s=e.title;return i.a.createElement("div",{key:t,className:"asset-tab ".concat(n===t?"selected":""," ").concat(t),title:s,onClick:function(){return a(t)}},i.a.createElement("span",{className:"asset-tab-name"},r))})))},je=(a(37),function(e){var t=e.onTabSelected,a=e.activeTab,n=e.showAlert,r=[{type:y,name:"Images",title:"Images"},{type:E,name:"Animations",title:"Animations"},{type:k,name:"Tiles",title:"Tiles"},{type:A,name:"Tilemaps",title:"Tilemaps"}];return i.a.createElement("div",{className:"asset-top-bar"},i.a.createElement("div",{className:"asset-tab-bar-container"},i.a.createElement(Ne,{options:r,onTabSelected:t,activeTab:a})),i.a.createElement("div",{className:"asset-actions-container"},i.a.createElement(Te,{showAlert:n})))}),Ie=(a(38),function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).iframe=void 0,n.postMessage=function(e){n.iframe&&n.iframe.contentWindow&&(e._fromVscode=!0,n.iframe.contentWindow.postMessage(e,"*"))},n.onMouseEnter=function(){var e,t;null===(e=n.iframe)||void 0===e||null===(t=e.contentWindow)||void 0===t||t.focus()},n.showAlert=function(e){n.setState({alert:e})},n.onTabSelected=function(e){if(e!==n.state.activeTab){var t=n.getAssetForTab(e);n.setState({activeTab:e,asset:t},(function(){n.openCurrentAsset()}))}},n.hideAlert=function(){var e;(null===(e=n.state.alert)||void 0===e?void 0:e.onClose)&&n.state.alert.onClose(),n.setState({alert:void 0})},n.handleIframeRef=function(e){n.iframe=e},n.onAssetSelected=function(e){null===e&&(e=n.getAssetForTab(n.state.activeTab)),n.setState({asset:e},(function(){return n.openCurrentAsset()}))},n.state={asset:n.getAssetForTab(y),activeTab:y,mostRecentAssets:{}},n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("message",(function(t){var a=t.data;switch(a.type){case"ready":e.openCurrentAsset();break;case"save-asset":e.onAssetSave(a.asset)}}))}},{key:"render",value:function(){var e=this.state,t=e.alert,a=e.activeTab,n=e.asset;return i.a.createElement("div",{className:"app ".concat(a,"-active")},i.a.createElement(je,{showAlert:this.showAlert,onTabSelected:this.onTabSelected,activeTab:a}),i.a.createElement("div",{className:"asset-editor-area"},i.a.createElement("iframe",{id:"editor",ref:this.handleIframeRef,onMouseEnter:this.onMouseEnter,title:"MakeCode Arcade sprite editor",src:"https://arcade.makecode.com/app/bc45f71fb939111c673a07163a1889739631a13d-5de495b635---asseteditor"}),i.a.createElement(ge,{showAlert:this.showAlert,asset:n,activeTab:a,onAssetSelected:this.onAssetSelected})),t&&i.a.createElement(se,Object.assign({},t,{onClose:this.hideAlert,visible:!0})))}},{key:"openCurrentAsset",value:function(){if(this.state.asset.type===A){for(var e=this.state.asset,t=C(),a=e.data.tileset,n=0;n<a.tiles.length;n++){var r=a.tiles[n];a.tiles[n]=t.resolveTile(r.id)}var i,s=Object(p.a)(t.getAssets(k));try{var o=function(){var e=i.value;a.tiles.some((function(t){return t.id===e.id}))||e.bitmap.width!==a.tileWidth||a.tiles.push(e)};for(s.s();!(i=s.n()).done;)o()}catch(c){s.e(c)}finally{s.f()}}this.postMessage({type:"open-asset",asset:this.state.asset}),this.setState({mostRecentAssets:Object(u.a)(Object(u.a)({},this.state.mostRecentAssets),{},Object(l.a)({},this.state.asset.type,this.state.asset.id))})}},{key:"onAssetSave",value:function(e){var t=C();if(e.type===A){var a=e,n=a.data,r=new pxt.sprite.Tilemap(n.tilemap.width,n.tilemap.height,0,0,n.tilemap.buf);a.data=new pxt.sprite.TilemapData(r,n.tileset,n.layers),a.data.editedTiles=n.editedTiles,a.data.deletedTiles=n.deletedTiles;for(var i=0;i<a.data.tileset.tiles.length;i++){var s=a.data.tileset.tiles[i],o=t.lookupAsset(s.type,s.id);o?s.internalID=o.internalID:a.data.tileset.tiles[i]=t.createNewTile(s.bitmap,s.id,s.meta.displayName),H(a.data.tileset.tiles[i])}pxt.sprite.updateTilemapReferencesFromResult(t,a);for(var c=0;c<a.data.tileset.tiles.length;c++){var l=a.data.tileset.tiles[c];l=t.lookupAsset(l.type,l.id),a.data.tileset.tiles[c]=l,H(l),t.updateAsset(l)}}H(e),C().updateAsset(e)}},{key:"getAssetForTab",value:function(e){var t,a,n,r=C();if(null===(t=this.state)||void 0===t||null===(a=t.mostRecentAssets)||void 0===a?void 0:a[e]){var i=r.lookupAsset(e,this.state.mostRecentAssets[e]);if(i)return i}switch(e){case y:n=r.getAssets(y)[0]||r.createNewImage(16,16);break;case k:n=r.getAssets(k)[0]||r.createNewTile(new pxt.sprite.Bitmap(16,16).data());break;case E:n=r.getAssets(E)[0]||r.createNewAnimation(16,16);break;case A:if(!(n=r.getAssets(A)[0])){var s=r.createNewTilemap("level",16,16),o=Object(c.a)(s,2),l=o[0];o[1];n=r.lookupAsset(A,l)}}return n.meta.displayName||(n.meta.displayName=pxt.getDefaultAssetDisplayName(e),n=r.updateAsset(n)),n}}]),a}(i.a.Component));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(Ie,null)),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.3160285a.chunk.js.map