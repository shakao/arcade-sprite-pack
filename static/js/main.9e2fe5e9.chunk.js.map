{"version":3,"sources":["components/Alert.tsx","components/Asset.tsx","util.ts","images.ts","share.ts","export.ts","lzma.ts","components/AssetList.tsx","App.tsx","index.tsx"],"names":["Alert","evt","stopPropagation","preventDefault","this","props","visible","title","text","icon","options","className","onClick","onClose","onAlertClick","children","map","el","i","key","React","Component","Asset","renameInput","onBlur","e","onRename","target","value","setState","renaming","onDoubleClick","handleInputRef","state","focus","prevProps","prevState","info","selected","onDelete","name","jres","src","previewURI","alt","defaultValue","ref","browserDownloadUInt8Array","buf","contentType","userContextWindow","onError","browserDownloadBase64","btoa","uint8ArrayToString","browserDownloadText","filename","browserDownloadDataUri","toDownloadDataUri","uri","navigator","test","userAgent","ia","stringToUint8Array","atob","split","blob","Blob","type","window","msSaveOrOpenBlob","link","document","createElement","download","href","body","appendChild","click","removeChild","location","b64","saveBlob","dataurl","b","protocol","input","len","length","res","Uint8Array","charCodeAt","String","fromCharCode","unicodeES5IdentifierStart","unicodeES5IdentifierPart","reservedWords","escapeIdentifier","char","n","trim","replace","a","lookupInUnicodeMap","indexOf","charAt","code","mid","lo","hi","getJRESImageFromDataString","data","palette","qname","tilemapTile","sourceFile","getJRESImage","jresDataToBitmap","getJRESImageFromImageLiteral","literal","defaultPattern","rows","sprite","spriteWidth","r","row","rowValues","c","push","Math","max","spriteHeight","result","Bitmap","set","imageLiteralToBitmap","undefined","bitmap","width","height","base64EncodeBitmap","bitmapToImageURI","qualifiedName","imgEncodeJRESImage","image","fileType","hexChars","get","bitmapToImageLiteral","f4EncodeImgCore","w","h","bpp","getPix","hex2","ptr","curr","shift","pushBits","j","toString","slice","hex","x","y","Uint8ClampedArray","parseInt","hexToUint8Array","x0","y0","dataLength","col","index","coordToIndex","setCore","getCore","cell","floor","ceil","jresURL","magic","out","mask","v","frame","colors","canvas","context","getContext","color","fillStyle","fillRect","toDataURL","backendEndpoint","arcadePalette","url","scriptID","substr","lastIndexOf","httpGetJSONAsync","meta","filesystem","config","paletteIsCustom","parsedConfig","JSON","parse","Array","isArray","typescriptFiles","Object","keys","filter","endsWith","projectImages","fileText","grabImagesFromJRES","grabImagesFromTypeScript","seenImages","existing","files","customPalette","jresText","metaEntry","metaMime","mimeType","metaNamespace","namespace","id","entry","literalRegex","match","Promise","resolve","reject","request","XMLHttpRequest","addEventListener","err","responseText","open","send","createProjectBlobAsync","assetTS","assetJRES","stringify","project","cloudId","targetVersions","editor","source","lzma","LZMA","compress","error","lzmaCompressAsync","assets","escapeName","escaped","takenNames","projectNamespace","asset","identifier","DEFAULT_JRES","AssetList","_items","_inputRef","handleMessage","msg","loadJres","jresImage","message","saving","items","postMessage","getJres","onAssetClick","onAssetRename","renameAsset","onAddButtonClick","addAsset","onDeleteButtonClick","alert","deleteAsset","hideAlert","onImportButtonClick","importAssets","onExportButtonClick","downloadProjectAsync","downloadTypeScriptAsync","storedJson","localStorage","getItem","storedItems","removeEventListener","setItem","getValidAssetName","splice","newName","fetchMakeCodeScriptAsync","then","forEach","findIndex","toLowerCase","getAssetIndex","placeholder","item","App","iframe","contentWindow","getElementById","ReactDOM","render","StrictMode"],"mappings":"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,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,KAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACniJC,EAA2B,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,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","file":"static/js/main.9e2fe5e9.chunk.js","sourcesContent":["import React from 'react';\r\nimport '../styles/Alert.css';\r\n\r\ninterface AlertOption {\r\n    text: string;\r\n    onClick: () => void;\r\n}\r\n\r\nexport interface AlertProps {\r\n    title: string;\r\n    text: string;\r\n    icon?: string;\r\n    options?: AlertOption[];\r\n    visible?: boolean;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport class Alert extends React.Component<AlertProps, {}> {\r\n    onAlertClick(evt: any) {\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.visible) return <div />;\r\n\r\n        const { title, text, icon, options } = this.props;\r\n        return <div className=\"alert-container\" onClick={this.props.onClose}>\r\n            <div className=\"alert\" onClick={this.onAlertClick}>\r\n                <div className=\"alert-title\">\r\n                    {icon && <i className={`alert-icon icon ${icon}`}></i>}\r\n                    <span>{title}</span>\r\n                    <i className=\"icon delete\" onClick={this.props.onClose}></i>\r\n                </div>\r\n                <div className=\"alert-text\">{text}</div>\r\n                {this.props.children && this.props.children}\r\n                {options && <div className=\"alert-options\">\r\n                    {options.map((el, i) => {\r\n                        return <div key={i} onClick={el.onClick}>{el.text}</div>\r\n                    })}\r\n                </div>}\r\n            </div>\r\n        </div>\r\n    }\r\n}","import React from 'react';\r\nimport { JRESImage } from '../images';\r\nimport '../styles/Asset.css';\r\n\r\nexport interface AssetInfo {\r\n    name: string;\r\n    jres: JRESImage;\r\n}\r\n\r\ninterface AssetProps {\r\n    info: AssetInfo;\r\n    selected: boolean;\r\n    onClick?: (e: any) => void;\r\n    onRename?: (name: string) => void;\r\n    onDelete?: (e: any) => void;\r\n}\r\n\r\ninterface AssetState {\r\n    renaming?: boolean;\r\n}\r\n\r\nexport class Asset extends React.Component<AssetProps, AssetState> {\r\n    private renameInput!: HTMLInputElement;\r\n    constructor(props: AssetProps) {\r\n        super(props);\r\n        this.state = { renaming: true }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.renameInput.focus();\r\n    }\r\n\r\n    componentDidUpdate(prevProps: AssetProps, prevState: AssetState) {\r\n        if (this.state.renaming && !prevState.renaming) {\r\n            this.renameInput.focus();\r\n        }\r\n    }\r\n\r\n    onBlur = (e: any) => {\r\n        if (this.props.onRename) this.props.onRename(e.target.value);\r\n        this.setState({ renaming: false });\r\n    }\r\n\r\n    onDoubleClick = (e: any) => {\r\n        this.setState({ renaming: true });\r\n    }\r\n\r\n    handleInputRef = (e: HTMLInputElement) => {\r\n        this.renameInput = e;\r\n    }\r\n\r\n    render() {\r\n        const { info, selected, onClick, onDelete } = this.props;\r\n        const { name, jres } = info;\r\n\r\n        return <div className={`asset ${selected ? \"selected\" : \"\"}`} onClick={onClick}>\r\n            {selected && <div className=\"asset-delete\" onClick={onDelete}>\r\n                <i className=\"icon delete\"></i>\r\n            </div>}\r\n            <div className=\"asset-img\">\r\n                <img src={jres.previewURI} alt=\"Preview of asset\" />\r\n            </div>\r\n            {this.state.renaming\r\n                ? <input className=\"asset-rename\" onBlur={this.onBlur} defaultValue={name} ref={this.handleInputRef} />\r\n                : <div className=\"asset-title\" onDoubleClick={this.onDoubleClick}><span>{name}</span></div>\r\n            }\r\n        </div>\r\n    }\r\n}","/**\r\n * This file contains util functions taken directly from pxt-core and lightly modified\r\n */\r\n\r\nexport const IMAGE_MIME_TYPE = \"image/x-mkcd-f4\"\r\n\r\nexport function browserDownloadUInt8Array(buf: Uint8Array, name: string, contentType: string = \"application/octet-stream\", userContextWindow?: Window, onError?: (err: any) => void): string {\r\n    return browserDownloadBase64(btoa(uint8ArrayToString(buf)), name, contentType, userContextWindow, onError)\r\n}\r\n\r\nexport function browserDownloadText(text: string, filename: string) {\r\n    const encoded = btoa(text);\r\n    browserDownloadDataUri(toDownloadDataUri(encoded, \"text/plain\"), filename)\r\n}\r\n\r\nexport function isEdge(): boolean {\r\n    return !!navigator && /Edge/i.test(navigator.userAgent);\r\n}\r\n\r\nexport function isIE(): boolean {\r\n    return !!navigator && /Trident/i.test(navigator.userAgent);\r\n}\r\n\r\nexport function browserDownloadDataUri(uri: string, name: string) {\r\n    if (isEdge() || isIE()) {\r\n        //Fix for edge\r\n        let byteString = atob(uri.split(',')[1]);\r\n        let ia = stringToUint8Array(byteString);\r\n        let blob = new Blob([ia], { type: \"img/png\" });\r\n        window.navigator.msSaveOrOpenBlob(blob, name);\r\n    } else {\r\n        let link = <any>window.document.createElement('a');\r\n        if (typeof link.download == \"string\") {\r\n            link.href = uri;\r\n            link.download = name;\r\n            document.body.appendChild(link); // for FF\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        } else {\r\n            document.location.href = uri;\r\n        }\r\n    }\r\n}\r\n\r\nexport function browserDownloadBase64(b64: string, name: string, contentType: string = \"application/octet-stream\", userContextWindow?: Window, onError?: (err: any) => void): string {\r\n    const saveBlob = (<any>window).navigator.msSaveOrOpenBlob;\r\n    const dataurl = toDownloadDataUri(b64, name);\r\n    try {\r\n        if (saveBlob) {\r\n            const b = new Blob([stringToUint8Array(atob(b64))], { type: contentType })\r\n            const result = (<any>window).navigator.msSaveOrOpenBlob(b, name);\r\n        } else browserDownloadDataUri(dataurl, name);\r\n    } catch (e) {\r\n        if (onError) onError(e);\r\n    }\r\n    return dataurl;\r\n}\r\n\r\nexport function toDownloadDataUri(b64: string, contentType: string): string {\r\n    let protocol = \"data\";\r\n    const dataurl = protocol + \":\" + contentType + \";base64,\" + b64\r\n    return dataurl;\r\n}\r\n\r\n// this will take lower 8 bits from each character\r\nexport function stringToUint8Array(input: string) {\r\n    let len = input.length;\r\n    let res = new Uint8Array(len)\r\n    for (let i = 0; i < len; ++i)\r\n        res[i] = input.charCodeAt(i) & 0xff;\r\n    return res;\r\n}\r\n\r\nexport function hexToUint8Array(hex: string) {\r\n    let r = new Uint8ClampedArray(hex.length >> 1);\r\n    for (let i = 0; i < hex.length; i += 2)\r\n        r[i >> 1] = parseInt(hex.slice(i, i + 2), 16)\r\n    return r\r\n}\r\n\r\nexport function uint8ArrayToString(input: ArrayLike<number>) {\r\n    let len = input.length;\r\n    let res = \"\"\r\n    for (let i = 0; i < len; ++i)\r\n        res += String.fromCharCode(input[i]);\r\n    return res;\r\n}\r\n\r\n\r\nconst unicodeES5IdentifierStart = [170, 170, 181, 181, 186, 186, 192, 214, 216, 246, 248, 705, 710, 721, 736, 740, 748, 748, 750, 750, 880, 884, 886, 887, 890, 893, 902, 902, 904, 906, 908, 908, 910, 929, 931, 1013, 1015, 1153, 1162, 1319, 1329, 1366, 1369, 1369, 1377, 1415, 1488, 1514, 1520, 1522, 1568, 1610, 1646, 1647, 1649, 1747, 1749, 1749, 1765, 1766, 1774, 1775, 1786, 1788, 1791, 1791, 1808, 1808, 1810, 1839, 1869, 1957, 1969, 1969, 1994, 2026, 2036, 2037, 2042, 2042, 2048, 2069, 2074, 2074, 2084, 2084, 2088, 2088, 2112, 2136, 2208, 2208, 2210, 2220, 2308, 2361, 2365, 2365, 2384, 2384, 2392, 2401, 2417, 2423, 2425, 2431, 2437, 2444, 2447, 2448, 2451, 2472, 2474, 2480, 2482, 2482, 2486, 2489, 2493, 2493, 2510, 2510, 2524, 2525, 2527, 2529, 2544, 2545, 2565, 2570, 2575, 2576, 2579, 2600, 2602, 2608, 2610, 2611, 2613, 2614, 2616, 2617, 2649, 2652, 2654, 2654, 2674, 2676, 2693, 2701, 2703, 2705, 2707, 2728, 2730, 2736, 2738, 2739, 2741, 2745, 2749, 2749, 2768, 2768, 2784, 2785, 2821, 2828, 2831, 2832, 2835, 2856, 2858, 2864, 2866, 2867, 2869, 2873, 2877, 2877, 2908, 2909, 2911, 2913, 2929, 2929, 2947, 2947, 2949, 2954, 2958, 2960, 2962, 2965, 2969, 2970, 2972, 2972, 2974, 2975, 2979, 2980, 2984, 2986, 2990, 3001, 3024, 3024, 3077, 3084, 3086, 3088, 3090, 3112, 3114, 3123, 3125, 3129, 3133, 3133, 3160, 3161, 3168, 3169, 3205, 3212, 3214, 3216, 3218, 3240, 3242, 3251, 3253, 3257, 3261, 3261, 3294, 3294, 3296, 3297, 3313, 3314, 3333, 3340, 3342, 3344, 3346, 3386, 3389, 3389, 3406, 3406, 3424, 3425, 3450, 3455, 3461, 3478, 3482, 3505, 3507, 3515, 3517, 3517, 3520, 3526, 3585, 3632, 3634, 3635, 3648, 3654, 3713, 3714, 3716, 3716, 3719, 3720, 3722, 3722, 3725, 3725, 3732, 3735, 3737, 3743, 3745, 3747, 3749, 3749, 3751, 3751, 3754, 3755, 3757, 3760, 3762, 3763, 3773, 3773, 3776, 3780, 3782, 3782, 3804, 3807, 3840, 3840, 3904, 3911, 3913, 3948, 3976, 3980, 4096, 4138, 4159, 4159, 4176, 4181, 4186, 4189, 4193, 4193, 4197, 4198, 4206, 4208, 4213, 4225, 4238, 4238, 4256, 4293, 4295, 4295, 4301, 4301, 4304, 4346, 4348, 4680, 4682, 4685, 4688, 4694, 4696, 4696, 4698, 4701, 4704, 4744, 4746, 4749, 4752, 4784, 4786, 4789, 4792, 4798, 4800, 4800, 4802, 4805, 4808, 4822, 4824, 4880, 4882, 4885, 4888, 4954, 4992, 5007, 5024, 5108, 5121, 5740, 5743, 5759, 5761, 5786, 5792, 5866, 5870, 5872, 5888, 5900, 5902, 5905, 5920, 5937, 5952, 5969, 5984, 5996, 5998, 6000, 6016, 6067, 6103, 6103, 6108, 6108, 6176, 6263, 6272, 6312, 6314, 6314, 6320, 6389, 6400, 6428, 6480, 6509, 6512, 6516, 6528, 6571, 6593, 6599, 6656, 6678, 6688, 6740, 6823, 6823, 6917, 6963, 6981, 6987, 7043, 7072, 7086, 7087, 7098, 7141, 7168, 7203, 7245, 7247, 7258, 7293, 7401, 7404, 7406, 7409, 7413, 7414, 7424, 7615, 7680, 7957, 7960, 7965, 7968, 8005, 8008, 8013, 8016, 8023, 8025, 8025, 8027, 8027, 8029, 8029, 8031, 8061, 8064, 8116, 8118, 8124, 8126, 8126, 8130, 8132, 8134, 8140, 8144, 8147, 8150, 8155, 8160, 8172, 8178, 8180, 8182, 8188, 8305, 8305, 8319, 8319, 8336, 8348, 8450, 8450, 8455, 8455, 8458, 8467, 8469, 8469, 8473, 8477, 8484, 8484, 8486, 8486, 8488, 8488, 8490, 8493, 8495, 8505, 8508, 8511, 8517, 8521, 8526, 8526, 8544, 8584, 11264, 11310, 11312, 11358, 11360, 11492, 11499, 11502, 11506, 11507, 11520, 11557, 11559, 11559, 11565, 11565, 11568, 11623, 11631, 11631, 11648, 11670, 11680, 11686, 11688, 11694, 11696, 11702, 11704, 11710, 11712, 11718, 11720, 11726, 11728, 11734, 11736, 11742, 11823, 11823, 12293, 12295, 12321, 12329, 12337, 12341, 12344, 12348, 12353, 12438, 12445, 12447, 12449, 12538, 12540, 12543, 12549, 12589, 12593, 12686, 12704, 12730, 12784, 12799, 13312, 19893, 19968, 40908, 40960, 42124, 42192, 42237, 42240, 42508, 42512, 42527, 42538, 42539, 42560, 42606, 42623, 42647, 42656, 42735, 42775, 42783, 42786, 42888, 42891, 42894, 42896, 42899, 42912, 42922, 43000, 43009, 43011, 43013, 43015, 43018, 43020, 43042, 43072, 43123, 43138, 43187, 43250, 43255, 43259, 43259, 43274, 43301, 43312, 43334, 43360, 43388, 43396, 43442, 43471, 43471, 43520, 43560, 43584, 43586, 43588, 43595, 43616, 43638, 43642, 43642, 43648, 43695, 43697, 43697, 43701, 43702, 43705, 43709, 43712, 43712, 43714, 43714, 43739, 43741, 43744, 43754, 43762, 43764, 43777, 43782, 43785, 43790, 43793, 43798, 43808, 43814, 43816, 43822, 43968, 44002, 44032, 55203, 55216, 55238, 55243, 55291, 63744, 64109, 64112, 64217, 64256, 64262, 64275, 64279, 64285, 64285, 64287, 64296, 64298, 64310, 64312, 64316, 64318, 64318, 64320, 64321, 64323, 64324, 64326, 64433, 64467, 64829, 64848, 64911, 64914, 64967, 65008, 65019, 65136, 65140, 65142, 65276, 65313, 65338, 65345, 65370, 65382, 65470, 65474, 65479, 65482, 65487, 65490, 65495, 65498, 65500,];\r\nconst unicodeES5IdentifierPart = [170, 170, 181, 181, 186, 186, 192, 214, 216, 246, 248, 705, 710, 721, 736, 740, 748, 748, 750, 750, 768, 884, 886, 887, 890, 893, 902, 902, 904, 906, 908, 908, 910, 929, 931, 1013, 1015, 1153, 1155, 1159, 1162, 1319, 1329, 1366, 1369, 1369, 1377, 1415, 1425, 1469, 1471, 1471, 1473, 1474, 1476, 1477, 1479, 1479, 1488, 1514, 1520, 1522, 1552, 1562, 1568, 1641, 1646, 1747, 1749, 1756, 1759, 1768, 1770, 1788, 1791, 1791, 1808, 1866, 1869, 1969, 1984, 2037, 2042, 2042, 2048, 2093, 2112, 2139, 2208, 2208, 2210, 2220, 2276, 2302, 2304, 2403, 2406, 2415, 2417, 2423, 2425, 2431, 2433, 2435, 2437, 2444, 2447, 2448, 2451, 2472, 2474, 2480, 2482, 2482, 2486, 2489, 2492, 2500, 2503, 2504, 2507, 2510, 2519, 2519, 2524, 2525, 2527, 2531, 2534, 2545, 2561, 2563, 2565, 2570, 2575, 2576, 2579, 2600, 2602, 2608, 2610, 2611, 2613, 2614, 2616, 2617, 2620, 2620, 2622, 2626, 2631, 2632, 2635, 2637, 2641, 2641, 2649, 2652, 2654, 2654, 2662, 2677, 2689, 2691, 2693, 2701, 2703, 2705, 2707, 2728, 2730, 2736, 2738, 2739, 2741, 2745, 2748, 2757, 2759, 2761, 2763, 2765, 2768, 2768, 2784, 2787, 2790, 2799, 2817, 2819, 2821, 2828, 2831, 2832, 2835, 2856, 2858, 2864, 2866, 2867, 2869, 2873, 2876, 2884, 2887, 2888, 2891, 2893, 2902, 2903, 2908, 2909, 2911, 2915, 2918, 2927, 2929, 2929, 2946, 2947, 2949, 2954, 2958, 2960, 2962, 2965, 2969, 2970, 2972, 2972, 2974, 2975, 2979, 2980, 2984, 2986, 2990, 3001, 3006, 3010, 3014, 3016, 3018, 3021, 3024, 3024, 3031, 3031, 3046, 3055, 3073, 3075, 3077, 3084, 3086, 3088, 3090, 3112, 3114, 3123, 3125, 3129, 3133, 3140, 3142, 3144, 3146, 3149, 3157, 3158, 3160, 3161, 3168, 3171, 3174, 3183, 3202, 3203, 3205, 3212, 3214, 3216, 3218, 3240, 3242, 3251, 3253, 3257, 3260, 3268, 3270, 3272, 3274, 3277, 3285, 3286, 3294, 3294, 3296, 3299, 3302, 3311, 3313, 3314, 3330, 3331, 3333, 3340, 3342, 3344, 3346, 3386, 3389, 3396, 3398, 3400, 3402, 3406, 3415, 3415, 3424, 3427, 3430, 3439, 3450, 3455, 3458, 3459, 3461, 3478, 3482, 3505, 3507, 3515, 3517, 3517, 3520, 3526, 3530, 3530, 3535, 3540, 3542, 3542, 3544, 3551, 3570, 3571, 3585, 3642, 3648, 3662, 3664, 3673, 3713, 3714, 3716, 3716, 3719, 3720, 3722, 3722, 3725, 3725, 3732, 3735, 3737, 3743, 3745, 3747, 3749, 3749, 3751, 3751, 3754, 3755, 3757, 3769, 3771, 3773, 3776, 3780, 3782, 3782, 3784, 3789, 3792, 3801, 3804, 3807, 3840, 3840, 3864, 3865, 3872, 3881, 3893, 3893, 3895, 3895, 3897, 3897, 3902, 3911, 3913, 3948, 3953, 3972, 3974, 3991, 3993, 4028, 4038, 4038, 4096, 4169, 4176, 4253, 4256, 4293, 4295, 4295, 4301, 4301, 4304, 4346, 4348, 4680, 4682, 4685, 4688, 4694, 4696, 4696, 4698, 4701, 4704, 4744, 4746, 4749, 4752, 4784, 4786, 4789, 4792, 4798, 4800, 4800, 4802, 4805, 4808, 4822, 4824, 4880, 4882, 4885, 4888, 4954, 4957, 4959, 4992, 5007, 5024, 5108, 5121, 5740, 5743, 5759, 5761, 5786, 5792, 5866, 5870, 5872, 5888, 5900, 5902, 5908, 5920, 5940, 5952, 5971, 5984, 5996, 5998, 6000, 6002, 6003, 6016, 6099, 6103, 6103, 6108, 6109, 6112, 6121, 6155, 6157, 6160, 6169, 6176, 6263, 6272, 6314, 6320, 6389, 6400, 6428, 6432, 6443, 6448, 6459, 6470, 6509, 6512, 6516, 6528, 6571, 6576, 6601, 6608, 6617, 6656, 6683, 6688, 6750, 6752, 6780, 6783, 6793, 6800, 6809, 6823, 6823, 6912, 6987, 6992, 7001, 7019, 7027, 7040, 7155, 7168, 7223, 7232, 7241, 7245, 7293, 7376, 7378, 7380, 7414, 7424, 7654, 7676, 7957, 7960, 7965, 7968, 8005, 8008, 8013, 8016, 8023, 8025, 8025, 8027, 8027, 8029, 8029, 8031, 8061, 8064, 8116, 8118, 8124, 8126, 8126, 8130, 8132, 8134, 8140, 8144, 8147, 8150, 8155, 8160, 8172, 8178, 8180, 8182, 8188, 8204, 8205, 8255, 8256, 8276, 8276, 8305, 8305, 8319, 8319, 8336, 8348, 8400, 8412, 8417, 8417, 8421, 8432, 8450, 8450, 8455, 8455, 8458, 8467, 8469, 8469, 8473, 8477, 8484, 8484, 8486, 8486, 8488, 8488, 8490, 8493, 8495, 8505, 8508, 8511, 8517, 8521, 8526, 8526, 8544, 8584, 11264, 11310, 11312, 11358, 11360, 11492, 11499, 11507, 11520, 11557, 11559, 11559, 11565, 11565, 11568, 11623, 11631, 11631, 11647, 11670, 11680, 11686, 11688, 11694, 11696, 11702, 11704, 11710, 11712, 11718, 11720, 11726, 11728, 11734, 11736, 11742, 11744, 11775, 11823, 11823, 12293, 12295, 12321, 12335, 12337, 12341, 12344, 12348, 12353, 12438, 12441, 12442, 12445, 12447, 12449, 12538, 12540, 12543, 12549, 12589, 12593, 12686, 12704, 12730, 12784, 12799, 13312, 19893, 19968, 40908, 40960, 42124, 42192, 42237, 42240, 42508, 42512, 42539, 42560, 42607, 42612, 42621, 42623, 42647, 42655, 42737, 42775, 42783, 42786, 42888, 42891, 42894, 42896, 42899, 42912, 42922, 43000, 43047, 43072, 43123, 43136, 43204, 43216, 43225, 43232, 43255, 43259, 43259, 43264, 43309, 43312, 43347, 43360, 43388, 43392, 43456, 43471, 43481, 43520, 43574, 43584, 43597, 43600, 43609, 43616, 43638, 43642, 43643, 43648, 43714, 43739, 43741, 43744, 43759, 43762, 43766, 43777, 43782, 43785, 43790, 43793, 43798, 43808, 43814, 43816, 43822, 43968, 44010, 44012, 44013, 44016, 44025, 44032, 55203, 55216, 55238, 55243, 55291, 63744, 64109, 64112, 64217, 64256, 64262, 64275, 64279, 64285, 64296, 64298, 64310, 64312, 64316, 64318, 64318, 64320, 64321, 64323, 64324, 64326, 64433, 64467, 64829, 64848, 64911, 64914, 64967, 65008, 65019, 65024, 65039, 65056, 65062, 65075, 65076, 65101, 65103, 65136, 65140, 65142, 65276, 65296, 65305, 65313, 65338, 65343, 65343, 65345, 65370, 65382, 65470, 65474, 65479, 65482, 65487, 65490, 65495, 65498, 65500,];\r\nconst reservedWords = [\"abstract\", \"any\", \"as\", \"break\",\r\n    \"case\", \"catch\", \"class\", \"continue\", \"const\", \"constructor\", \"debugger\",\r\n    \"declare\", \"default\", \"delete\", \"do\", \"else\", \"enum\", \"export\", \"extends\",\r\n    \"false\", \"finally\", \"for\", \"from\", \"function\", \"get\", \"if\", \"implements\",\r\n    \"import\", \"in\", \"instanceof\", \"interface\", \"is\", \"let\", \"module\", \"namespace\",\r\n    \"new\", \"null\", \"package\", \"private\", \"protected\", \"public\",\r\n    \"require\", \"global\", \"return\", \"set\", \"static\", \"super\", \"switch\",\r\n    \"symbol\", \"this\", \"throw\", \"true\", \"try\", \"type\", \"typeof\", \"var\", \"void\",\r\n    \"while\", \"with\", \"yield\", \"async\", \"await\", \"of\", \"Math\"];\r\n\r\n\r\nexport function escapeIdentifier(name: string): string {\r\n    if (!name) return '_';\r\n\r\n    let n = name.trim().replace(/\\s+/g, \"_\").replace(/[^a-zA-Z0-9_$]/g, a =>\r\n        isIdentifierPart(a.charCodeAt(0)) ? a : \"\");\r\n\r\n    if (n.length === 0 || reservedWords.indexOf(n) !== -1 || !isIdentifierStart(n.charAt(0))) {\r\n        n = \"_\" + n;\r\n    }\r\n\r\n    return n;\r\n}\r\n\r\nfunction isIdentifierPart(charCode: number) {\r\n    return lookupInUnicodeMap(charCode, unicodeES5IdentifierPart);\r\n}\r\n\r\nfunction isIdentifierStart(char: string) {\r\n    if (/[a-zA-Z_$]/.test(char)) return true;\r\n    return lookupInUnicodeMap(char.charCodeAt(0), unicodeES5IdentifierStart);\r\n}\r\n\r\nfunction lookupInUnicodeMap(code: number, map: number[]): boolean {\r\n    // Bail out quickly if it couldn't possibly be in the map.\r\n    if (code < map[0]) {\r\n        return false;\r\n    }\r\n\r\n    // Perform binary search in one of the Unicode range maps\r\n    let lo = 0;\r\n    let hi: number = map.length;\r\n    let mid: number;\r\n\r\n    while (lo + 1 < hi) {\r\n        mid = lo + (hi - lo) / 2;\r\n        // mid has to be even to catch a range's beginning\r\n        mid -= mid % 2;\r\n        if (map[mid] <= code && code <= map[mid + 1]) {\r\n            return true;\r\n        }\r\n\r\n        if (code < map[mid]) {\r\n            hi = mid;\r\n        }\r\n        else {\r\n            lo = mid + 2;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n","import { uint8ArrayToString, hexToUint8Array } from \"./util\";\r\n\r\nexport interface JRESImage {\r\n    data: string; // Base64 encoded string of f4 encoded bytes\r\n    previewURI: string; // PNG data uri\r\n    width: number;\r\n    height: number;\r\n\r\n    qualifiedName?: string;\r\n    tilemapTile?: boolean;\r\n    sourceFile?: string;\r\n}\r\n\r\nexport interface ImageInfo {\r\n    width: number;\r\n    height: number;\r\n    pixels: Uint8ClampedArray;\r\n}\r\n\r\nexport async function getImageFromURIAsync(uri: string): Promise<ImageInfo | null> {\r\n    const loaded = await loadImageAsync(uri);\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = loaded.width;\r\n    canvas.height = loaded.height;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return null;\r\n\r\n    ctx.drawImage(loaded, 0, 0);\r\n    const data = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n    return {\r\n        width: data.width,\r\n        height: data.height,\r\n        pixels: data.data\r\n    };\r\n}\r\n\r\nasync function loadImageAsync(uri: string): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>(resolve => {\r\n        const el = document.createElement(\"img\");\r\n        el.src = uri\r\n        el.onload = () => {\r\n            resolve(el)\r\n        };\r\n    })\r\n}\r\n\r\nexport function getJRESImageFromDataString(data: string, palette: string[], qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\r\n    const bitmap = jresDataToBitmap(data);\r\n\r\n    return getJRESImage(bitmap, palette, data, qname, tilemapTile, sourceFile)\r\n}\r\n\r\nexport function getJRESImageFromImageLiteral(literal: string, palette: string[], sourceFile?: string) {\r\n    const bitmap = imageLiteralToBitmap(literal);\r\n    return getJRESImage(bitmap, palette, undefined, undefined, undefined, sourceFile)\r\n}\r\n\r\n\r\nfunction getJRESImage(bitmap: Bitmap, palette: string[], data?: string, qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\r\n    return {\r\n        width: bitmap.width,\r\n        height: bitmap.height,\r\n        data: data || base64EncodeBitmap(bitmap),\r\n        previewURI: bitmapToImageURI(bitmap, palette),\r\n        qualifiedName: qname,\r\n        tilemapTile,\r\n        sourceFile\r\n    }\r\n}\r\n\r\nexport function imgEncodeJRESImage(image: JRESImage) {\r\n    const bitmap = jresDataToBitmap(image.data);\r\n    return bitmapToImageLiteral(bitmap, \"typescript\");\r\n}\r\n\r\n\r\nconst hexChars = [\".\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\"];\r\n\r\nfunction bitmapToImageLiteral(bitmap: Bitmap, fileType: \"typescript\" | \"python\"): string {\r\n    let res = '';\r\n    switch (fileType) {\r\n        case \"python\":\r\n            res = \"img(\\\"\\\"\\\"\";\r\n            break;\r\n        default:\r\n            res = \"img`\";\r\n            break;\r\n    }\r\n\r\n    if (bitmap) {\r\n        for (let r = 0; r < bitmap.height; r++) {\r\n            res += \"\\n\"\r\n            for (let c = 0; c < bitmap.width; c++) {\r\n                res += hexChars[bitmap.get(c, r)] + \" \";\r\n            }\r\n        }\r\n    }\r\n\r\n    res += \"\\n\";\r\n\r\n    switch (fileType) {\r\n        case \"python\":\r\n            res += \"\\\"\\\"\\\")\";\r\n            break;\r\n        default:\r\n            res += \"`\";\r\n            break;\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\n\r\n/**\r\n * Encodes the image in the image/mkcd-f4 format (used for the data attribute in jres files)\r\n * @param image\r\n * @param colors\r\n */\r\nexport function f4EncodeImage(image: ImageInfo, colors: string[]) {\r\n    const palette = colorsToNumbers(colors);\r\n\r\n    return f4EncodeImgCore(image.width, image.height, 4, (x, y) => {\r\n        const index = y * image.width + x;\r\n        return closestColor(image.pixels, index << 2, palette);\r\n    });\r\n}\r\n\r\n/**\r\n * Encodes the image as an img`` literal\r\n * @param image\r\n * @param colors\r\n */\r\nexport function imgEncodeImage(image: ImageInfo, colors: string[]) {\r\n    const palette = colorsToNumbers(colors);\r\n\r\n    return imgEncodeImgCore(image.width, image.height, (x, y) => {\r\n        const index = y * image.width + x;\r\n        return closestColor(image.pixels, index << 2, palette);\r\n    });\r\n}\r\n\r\nfunction colorsToNumbers(colors: string[]): number[][] {\r\n    const res: number[][] = [];\r\n    for (let i = 0; i < colors.length; i++) {\r\n        const color = parseColorString(colors[i]);\r\n        res.push([_r(color), _g(color), _b(color)]);\r\n    }\r\n    return res;\r\n}\r\n\r\n// use geometric distance on colors\r\nfunction scale(v: number) {\r\n    return v * v\r\n}\r\n\r\nfunction closestColor(buf: Uint8ClampedArray, pix: number, palette: number[][], alpha = true) {\r\n    if (alpha && buf[pix + 3] < 100)\r\n        return 0 // transparent\r\n    let mindelta = 0\r\n    let idx = -1\r\n    for (let i = alpha ? 1 : 0; i < palette.length; ++i) {\r\n        let delta = scale(palette[i][0] - buf[pix + 0]) + scale(palette[i][1] - buf[pix + 1]) + scale(palette[i][2] - buf[pix + 2])\r\n        if (idx < 0 || delta < mindelta) {\r\n            idx = i\r\n            mindelta = delta\r\n        }\r\n    }\r\n    return idx\r\n}\r\n\r\nfunction f4EncodeImgCore(w: number, h: number, bpp: number, getPix: (x: number, y: number) => number) {\r\n    let r = hex2(0xe0 | bpp) + hex2(w) + hex2(h) + \"00\"\r\n    let ptr = 4\r\n    let curr = 0\r\n    let shift = 0\r\n\r\n    let pushBits = (n: number) => {\r\n        curr |= n << shift\r\n        // eslint-disable-next-line\r\n        if (shift == 8 - bpp) {\r\n            r += hex2(curr)\r\n            ptr++\r\n            curr = 0\r\n            shift = 0\r\n        } else {\r\n            shift += bpp\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < w; ++i) {\r\n        for (let j = 0; j < h; ++j)\r\n            pushBits(getPix(i, j))\r\n        // eslint-disable-next-line\r\n        while (shift != 0)\r\n            pushBits(0)\r\n        if (bpp > 1) {\r\n            while (ptr & 3)\r\n                pushBits(0)\r\n        }\r\n    }\r\n\r\n    return r\r\n\r\n    function hex2(n: number) {\r\n        return (\"0\" + n.toString(16)).slice(-2)\r\n    }\r\n}\r\n\r\nfunction imgEncodeImgCore(w: number, h: number, getPix: (x: number, y: number) => number) {\r\n    let res = \"img`\\n    \"\r\n    for (let r = 0; r < h; r++) {\r\n        let row: number[] = []\r\n        for (let c = 0; c < w; c++) {\r\n            row.push(getPix(c, r));\r\n        }\r\n        res += row.map(n => n.toString(16)).join(\" \");\r\n        res += \"\\n    \"\r\n    }\r\n    res += \"`\";\r\n    return res;\r\n}\r\n\r\nfunction base64EncodeBitmap(bitmap: Bitmap) {\r\n    const hex = f4EncodeImgCore(bitmap.width, bitmap.height, 4, (x, y) => bitmap.get(x, y));\r\n    return btoa(uint8ArrayToString(hexToUint8Array(hex)))\r\n}\r\n\r\nfunction _r(color: number) { return (color >> 16) & 0xff }\r\nfunction _g(color: number) { return (color >> 8) & 0xff }\r\nfunction _b(color: number) { return color & 0xff }\r\n\r\nfunction parseColorString(color: string) {\r\n    if (color) {\r\n        if (color.length === 6) {\r\n            return parseInt(\"0x\" + color);\r\n        }\r\n        else if (color.length === 7) {\r\n            return parseInt(\"0x\" + color.substr(1));\r\n        }\r\n    }\r\n    return 0;\r\n}\r\n\r\n/**\r\n * 16-color sprite\r\n */\r\nexport class Bitmap {\r\n    protected buf: Uint8ClampedArray;\r\n\r\n    constructor(public width: number, public height: number, public x0 = 0, public y0 = 0, buf?: Uint8ClampedArray) {\r\n        this.buf = buf || new Uint8ClampedArray(this.dataLength());\r\n    }\r\n\r\n    set(col: number, row: number, value: number) {\r\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\r\n            const index = this.coordToIndex(col, row);\r\n            this.setCore(index, value);\r\n        }\r\n    }\r\n\r\n    get(col: number, row: number) {\r\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\r\n            const index = this.coordToIndex(col, row);\r\n            return this.getCore(index);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    protected coordToIndex(col: number, row: number) {\r\n        return col + row * this.width;\r\n    }\r\n\r\n    protected getCore(index: number) {\r\n        const cell = Math.floor(index / 2);\r\n        if (index % 2 === 0) {\r\n            return this.buf[cell] & 0xf;\r\n        }\r\n        else {\r\n            return (this.buf[cell] & 0xf0) >> 4;\r\n        }\r\n    }\r\n\r\n    protected setCore(index: number, value: number) {\r\n        const cell = Math.floor(index / 2);\r\n        if (index % 2 === 0) {\r\n            this.buf[cell] = (this.buf[cell] & 0xf0) | (value & 0xf);\r\n        }\r\n        else {\r\n            this.buf[cell] = (this.buf[cell] & 0x0f) | ((value & 0xf) << 4);\r\n        }\r\n    }\r\n\r\n    protected dataLength() {\r\n        return Math.ceil(this.width * this.height / 2);\r\n    }\r\n}\r\n\r\n\r\nfunction jresDataToBitmap(jresURL: string) {\r\n    let data = atob(jresURL.slice(jresURL.indexOf(\",\") + 1))\r\n    let magic = data.charCodeAt(0);\r\n    let w = data.charCodeAt(1);\r\n    let h = data.charCodeAt(2);\r\n\r\n    if (magic === 0x87) {\r\n        magic = 0xe0 | data.charCodeAt(1);\r\n        w = data.charCodeAt(2) | (data.charCodeAt(3) << 8);\r\n        h = data.charCodeAt(4) | (data.charCodeAt(5) << 8);\r\n        data = data.slice(4);\r\n    }\r\n\r\n    const out = new Bitmap(w, h);\r\n\r\n    let index = 4\r\n    if (magic === 0xe1) {\r\n        // Monochrome\r\n        let mask = 0x01\r\n        let v = data.charCodeAt(index++)\r\n        for (let x = 0; x < w; ++x) {\r\n            for (let y = 0; y < h; ++y) {\r\n                out.set(x, y, (v & mask) ? 1 : 0);\r\n                mask <<= 1\r\n                // eslint-disable-next-line\r\n                if (mask == 0x100) {\r\n                    mask = 0x01\r\n                    v = data.charCodeAt(index++)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        // Color\r\n        for (let x = 0; x < w; x++) {\r\n            for (let y = 0; y < h; y += 2) {\r\n                let v = data.charCodeAt(index++)\r\n                out.set(x, y, v & 0xf);\r\n                // eslint-disable-next-line\r\n                if (y != h - 1) {\r\n                    out.set(x, y + 1, (v >> 4) & 0xf);\r\n                }\r\n            }\r\n            while (index & 3) index++\r\n        }\r\n    }\r\n\r\n    return out;\r\n}\r\n\r\nfunction imageLiteralToBitmap(text: string, defaultPattern?: string): Bitmap {\r\n    // Strip the tagged template string business and the whitespace. We don't have to exhaustively\r\n    // replace encoded characters because the compiler will catch any disallowed characters and throw\r\n    // an error before the decompilation happens. 96 is backtick and 9 is tab\r\n    text = text.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g, \"\").trim();\r\n    // eslint-disable-next-line\r\n    text = text.replace(/^[\"`\\(\\)]*/, '').replace(/[\"`\\(\\)]*$/, '');\r\n    text = text.replace(/&#10;/g, \"\\n\");\r\n\r\n    if (!text && defaultPattern)\r\n        text = defaultPattern;\r\n\r\n    const rows = text.split(\"\\n\");\r\n\r\n    // We support \"ragged\" sprites so not all rows will be the same length\r\n    const sprite: number[][] = [];\r\n    let spriteWidth = 0;\r\n\r\n    for (let r = 0; r < rows.length; r++) {\r\n        const row = rows[r];\r\n        const rowValues: number[] = [];\r\n        for (let c = 0; c < row.length; c++) {\r\n            // This list comes from libs/screen/targetOverrides.ts in pxt-arcade\r\n            // Technically, this could change per target.\r\n            switch (row[c]) {\r\n                case \"0\": case \".\": rowValues.push(0); break;\r\n                case \"1\": case \"#\": rowValues.push(1); break;\r\n                case \"2\": case \"T\": rowValues.push(2); break;\r\n                case \"3\": case \"t\": rowValues.push(3); break;\r\n                case \"4\": case \"N\": rowValues.push(4); break;\r\n                case \"5\": case \"n\": rowValues.push(5); break;\r\n                case \"6\": case \"G\": rowValues.push(6); break;\r\n                case \"7\": case \"g\": rowValues.push(7); break;\r\n                case \"8\": rowValues.push(8); break;\r\n                case \"9\": rowValues.push(9); break;\r\n                case \"a\": case \"A\": case \"R\": rowValues.push(10); break;\r\n                case \"b\": case \"B\": case \"P\": rowValues.push(11); break;\r\n                case \"c\": case \"C\": case \"p\": rowValues.push(12); break;\r\n                case \"d\": case \"D\": case \"O\": rowValues.push(13); break;\r\n                case \"e\": case \"E\": case \"Y\": rowValues.push(14); break;\r\n                case \"f\": case \"F\": case \"W\": rowValues.push(15); break;\r\n            }\r\n        }\r\n\r\n        if (rowValues.length) {\r\n            sprite.push(rowValues);\r\n            spriteWidth = Math.max(spriteWidth, rowValues.length);\r\n        }\r\n    }\r\n\r\n    const spriteHeight = sprite.length;\r\n\r\n    const result = new Bitmap(spriteWidth, spriteHeight)\r\n\r\n    for (let r = 0; r < spriteHeight; r++) {\r\n        const row = sprite[r];\r\n        for (let c = 0; c < spriteWidth; c++) {\r\n            if (c < row.length) {\r\n                result.set(c, r, row[c]);\r\n            }\r\n            else {\r\n                result.set(c, r, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Converts a bitmap into a square image suitable for display\r\n */\r\nfunction bitmapToImageURI(frame: Bitmap, colors: string[]) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = frame.width;\r\n    canvas.height = frame.height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n\r\n    if (context) {\r\n        for (let c = 0; c < frame.width; c++) {\r\n            for (let r = 0; r < frame.height; r++) {\r\n                const color = frame.get(c, r);\r\n\r\n                if (color) {\r\n                    context.fillStyle = colors[color];\r\n                    context.fillRect(c, r, 1, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    return canvas.toDataURL();\r\n}\r\n\r\n","import { getJRESImageFromDataString, getJRESImageFromImageLiteral, JRESImage } from \"./images\";\r\nimport { IMAGE_MIME_TYPE } from \"./util\";\r\n\r\nconst backendEndpoint = \"https://makecode.com/api\";\r\n\r\nexport interface JRes {\r\n    id: string; // something like \"sounds.bark\"\r\n    data: string;\r\n    dataEncoding?: string; // must be \"base64\" or missing (meaning the same)\r\n    icon?: string; // URL (usually data-URI) for the icon\r\n    namespace?: string; // used to construct id\r\n    mimeType: string;\r\n    tilemapTile?: boolean;\r\n    tileset?: string[];\r\n}\r\n\r\nexport const arcadePalette = [\r\n    \"#000000\",\r\n    \"#ffffff\",\r\n    \"#ff2121\",\r\n    \"#ff93c4\",\r\n    \"#ff8135\",\r\n    \"#fff609\",\r\n    \"#249ca3\",\r\n    \"#78dc52\",\r\n    \"#003fad\",\r\n    \"#87f2ff\",\r\n    \"#8e2ec4\",\r\n    \"#a4839f\",\r\n    \"#5c406c\",\r\n    \"#e5cdc4\",\r\n    \"#91463d\",\r\n    \"#000000\"\r\n];\r\n\r\n/*\r\n{\r\n    \"kind\": \"script\",\r\n    \"id\": \"62736-71028-62577-28752\",\r\n    \"shortid\": \"_UAVXEwU7RAew\",\r\n    \"time\": 1595883166,\r\n    \"name\": \"Untitled\",\r\n    \"description\": \"Made with  in Microsoft MakeCode Arcade.\",\r\n    \"target\": \"arcade\",\r\n    \"editor\": \"tsprj\",\r\n    \"meta\": {\r\n        \"versions\": {\r\n            \"branch\": \"v1.0.14\",\r\n            \"tag\": \"v1.0.14\",\r\n            \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/1460ac1c88950799eb51c9c297588c8abdc91077\",\r\n            \"target\": \"1.0.14\",\r\n            \"pxt\": \"6.1.41\"\r\n        },\r\n        \"blocksHeight\": 0,\r\n        \"blocksWidth\": 0\r\n    },\r\n    \"thumb\": false\r\n}\r\n*/\r\n\r\nexport interface ScriptMeta {\r\n    kind: \"script\";\r\n    id: string;\r\n    shortid: string;\r\n    time: number;\r\n    name: string;\r\n    description: string;\r\n    target: string;\r\n    editor: string;\r\n    meta: {\r\n        versions: {\r\n            branch: string;\r\n            tag: string;\r\n            commits: string;\r\n            target: string;\r\n            pxt: string;\r\n        };\r\n        blocksHeight: number;\r\n        blocksWidth: number;\r\n    };\r\n    thumb: boolean;\r\n}\r\n\r\nexport interface ScriptInfo {\r\n    meta: ScriptMeta;\r\n    files: {[index: string]: string};\r\n    customPalette?: string[];\r\n    images: JRESImage[];\r\n}\r\n\r\n\r\nexport async function fetchMakeCodeScriptAsync(url: string) {\r\n    // https://makecode.com/_UAVXEwU7RAew\r\n    // https://arcade.makecode.com/62736-71028-62577-28752\r\n    let scriptID = url.trim();\r\n\r\n    if (scriptID.indexOf(\"/\") !== -1) {\r\n        scriptID = scriptID.substr(scriptID.lastIndexOf(\"/\") + 1)\r\n    }\r\n\r\n    const meta: ScriptMeta = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID);\r\n\r\n    // A mapping of filenames to filecontents\r\n    const filesystem: {[index: string]: string} = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID + \"/text\");\r\n\r\n    const config = filesystem[\"pxt.json\"];\r\n\r\n    let palette = arcadePalette;\r\n    let paletteIsCustom = false;\r\n\r\n    if (config) {\r\n        try {\r\n            let parsedConfig = JSON.parse(config);\r\n\r\n            if (parsedConfig?.palette && Array.isArray(parsedConfig.palette)) {\r\n                palette = parsedConfig.palette.slice()\r\n                paletteIsCustom = true;\r\n            }\r\n        }\r\n        catch (e) {\r\n            // ignore\r\n        }\r\n    }\r\n\r\n    // Don't bother checking python and blocks files, they should all get converted to a matching ts\r\n    // file that will also contain all image literals\r\n    const typescriptFiles = Object.keys(filesystem).filter(filename =>\r\n        filename.endsWith(\".ts\") || filename.endsWith(\".jres\"));\r\n\r\n    // Grab any existing images in the project\r\n    const projectImages: JRESImage[] = [];\r\n    for (const filename of typescriptFiles) {\r\n\r\n        const fileText = filesystem[filename];\r\n        if (filename.endsWith(\"jres\")) {\r\n            projectImages.push(...grabImagesFromJRES(fileText, filename, palette));\r\n        }\r\n        else {\r\n            projectImages.push(...grabImagesFromTypeScript(fileText, filename, palette));\r\n        }\r\n    }\r\n\r\n    // Dedupe the images based on their content\r\n    const seenImages: {[index: string]: JRESImage} = {};\r\n\r\n    for (const image of projectImages) {\r\n        const existing = seenImages[image.data];\r\n        // Prefer images that have qualified names (from JRES)\r\n        if (!existing || (!existing.qualifiedName && image.qualifiedName)) {\r\n            seenImages[image.data] = image;\r\n        }\r\n    }\r\n\r\n    return {\r\n        meta,\r\n        files: filesystem,\r\n        projectImages: Object.keys(seenImages).map(data => seenImages[data]),\r\n        customPalette: paletteIsCustom ? palette : undefined\r\n    };\r\n}\r\n\r\nfunction grabImagesFromJRES(jresText: string, filename: string, palette = arcadePalette): JRESImage[] {\r\n    let jres: {[index: string]: JRes | string};\r\n\r\n    try {\r\n        jres = JSON.parse(jresText);\r\n    }\r\n    catch (e) {\r\n        return [];\r\n    }\r\n\r\n    const metaEntry = jres[\"*\"] as JRes | undefined;\r\n\r\n    const metaMime = metaEntry?.mimeType || \"\";\r\n    const metaNamespace = metaEntry?.namespace || \"\";\r\n\r\n    const result: JRESImage[] = [];\r\n\r\n    for (const id of Object.keys(jres)) {\r\n        if (id === \"*\") continue;\r\n\r\n        let entry = jres[id];\r\n\r\n        if (typeof entry === \"string\") {\r\n            if (metaMime === IMAGE_MIME_TYPE) {\r\n                result.push(getJRESImageFromDataString(entry, palette, metaNamespace ? metaNamespace + \".\" + id : id, false, filename));\r\n            }\r\n        }\r\n        else if (entry.mimeType === IMAGE_MIME_TYPE) {\r\n            result.push(getJRESImageFromDataString(entry.data, palette, metaNamespace ? metaNamespace + \".\" + id : id, entry.tilemapTile, filename));\r\n        }\r\n    }\r\n\r\n    return result\r\n}\r\n\r\nfunction grabImagesFromTypeScript(fileText: string, filename: string, palette = arcadePalette) {\r\n    const literalRegex = /img\\s*`[\\s\\da-f.#tngrpoyw]*`/img;\r\n\r\n    const res: JRESImage[] = [];\r\n\r\n    fileText.replace(literalRegex, match => {\r\n        res.push(getJRESImageFromImageLiteral(match, palette, filename))\r\n        return \"\";\r\n    });\r\n\r\n    return res;\r\n}\r\n\r\n\r\nfunction httpGetJSONAsync(url: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        const request = new XMLHttpRequest();\r\n\r\n        request.addEventListener(\"error\", err => {\r\n            reject(err);\r\n        });\r\n\r\n        request.addEventListener(\"load\", () => {\r\n            try {\r\n                resolve(JSON.parse(request.responseText));\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n\r\n        request.open(\"GET\", url);\r\n        request.send();\r\n    });\r\n}","import { AssetInfo, Asset } from \"./components/Asset\";\r\nimport { lzmaCompressAsync } from \"./lzma\";\r\nimport { JRes } from \"./share\";\r\nimport { escapeIdentifier, IMAGE_MIME_TYPE, browserDownloadUInt8Array, browserDownloadText } from \"./util\";\r\nimport { imgEncodeJRESImage } from \"./images\";\r\n\r\n\r\ninterface PXTHexFile {\r\n    meta: {\r\n        cloudId: \"pxt/arcade\";\r\n        targetVersions: any;\r\n        editor: \"tsprj\";\r\n        name: string;\r\n    };\r\n    source: string; // a mapping of filenames to file text that has been stringified\r\n}\r\n\r\nconst PROJECT_COMMENT = `/*\r\n * This project was created using arcade-sprite-pack. If you\r\n * want to publish this project to GitHub as a sprite pack, do\r\n * not add any code to this file! The code that is running in the\r\n * simulator can be edited by clicking on the file explorer to the\r\n * left and selecting \"test.ts\". Any code added to \"test.ts\" will\r\n * not be added to a project that imports this sprite pack as an\r\n * extension.\r\n *\r\n * If you don't wish to publish this project, you can use this project\r\n * as-is. Your sprites should show up in the sprite gallery. Make sure\r\n * you delete the code in \"test.ts\"!\r\n *\r\n *\r\n * To publish this project to GitHub:\r\n *   1. Rename this project to something descriptive\r\n *   2. Click the GitHub button in the bottom bar next to the save\r\n *      button (sign in to GitHub if prompted)\r\n *   3. Choose a name for your repository. This is the name that\r\n *      people will see when importing your project.\r\n *   4. Make sure \"public repository\" is selected in the dropdown\r\n *      if you want other people to be able to use your sprites\r\n *   5. Click \"go ahead\"\r\n *   6. If you are on a shared computer, make sure you sign out of\r\n *      GitHub!\r\n *\r\n *\r\n * To add a published project to an Arcade project:\r\n *   1. Inside the MakeCode editor, click \"Extensions\" under \"Advanced\"\r\n *      in the toolbox\r\n *   2. Inside the search box that appears, type your GitHub username\r\n *      followed by a \"/\" and the name of the repository. It should\r\n *      look something like this: username/repository\r\n *   3. Hit enter on your keyboard and click the card that appears\r\n *   4. The sprites should now show up in the gallery of the sprite\r\n *      editor (at the bottom)\r\n * */\r\n`;\r\n\r\nconst MAIN_BLOCKS = \"main.blocks\"\r\nconst ASSET_TS = \"assets.ts\";\r\nconst ASSET_JRES = \"assets.jres\"\r\nconst TEST_TS = \"test.ts\";\r\nconst MAIN_TS = \"main.ts\";\r\nconst PXT_JSON = \"pxt.json\";\r\nconst README_MD = \"README.md\";\r\n\r\n\r\nfunction createProjectBlobAsync(name: string, assetTS: string, assetJRES: string) {\r\n    const config = JSON.stringify({\r\n        \"name\": name,\r\n        \"dependencies\": {\r\n            \"device\": \"file:../device\" // required for arcade\r\n        },\r\n        \"description\": \"An asset pack for MakeCode Arcade\",\r\n        \"files\": [\r\n            MAIN_BLOCKS,\r\n            MAIN_TS,\r\n            ASSET_JRES,\r\n            ASSET_TS\r\n        ],\r\n        \"testFiles\": [\r\n            TEST_TS\r\n        ]\r\n    }, null, 4);\r\n\r\n\r\n    const files: {[index: string]: string} = {};\r\n    files[PXT_JSON] = config;\r\n    files[MAIN_TS] = PROJECT_COMMENT;\r\n    files[ASSET_TS] = assetTS;\r\n    files[ASSET_JRES] = assetJRES;\r\n    files[README_MD] = \"\"\r\n    files[MAIN_BLOCKS] =`<xml xmlns=\"http://www.w3.org/1999/xhtml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"></block></xml>`;\r\n\r\n\r\n    const project: PXTHexFile = {\r\n        meta: {\r\n            cloudId: \"pxt/arcade\",\r\n            targetVersions: {},\r\n            name: name,\r\n            editor: \"tsprj\"\r\n        },\r\n        source: JSON.stringify(files)\r\n    };\r\n\r\n    return lzmaCompressAsync(JSON.stringify(project));\r\n}\r\n\r\nexport async function downloadProjectAsync(name: string, assets: AssetInfo[]) {\r\n    let assetTS = \"\";\r\n    const assetJRES: {[index: string]: JRes | string} = {};\r\n\r\n    const projectNamespace = escapeIdentifier(name) + \"Sprites\";\r\n\r\n    let takenNames: {[index: string]: boolean} = {};\r\n\r\n\r\n    // @ts-ignore\r\n    assetJRES[\"*\"] = {\r\n        namespace: projectNamespace,\r\n        mimeType: IMAGE_MIME_TYPE\r\n    }\r\n\r\n    for (const asset of assets) {\r\n        const identifier = escapeName(asset.name);\r\n\r\n        if (asset.jres.tilemapTile) {\r\n            assetJRES[identifier] = {\r\n                id: identifier,\r\n                data: asset.jres.data,\r\n                tilemapTile: true,\r\n                mimeType: IMAGE_MIME_TYPE\r\n            };\r\n            assetTS += `    //% fixedInstance jres blockIdentity=images._tile\\n`\r\n        }\r\n        else {\r\n            assetJRES[identifier] = asset.jres.data;\r\n            assetTS += `    //% fixedInstance jres blockIdentity=images._image\\n`\r\n        }\r\n\r\n        assetTS += `    export const ${identifier} = image.ofBuffer(hex\\`\\`);\\n`\r\n    }\r\n\r\n    assetTS = `namespace ${projectNamespace} {\\n${assetTS}\\n}\\n`;\r\n\r\n\r\n    const project = await createProjectBlobAsync(name, assetTS, JSON.stringify(assetJRES));\r\n    return browserDownloadUInt8Array(project, name + \".mkcd\");\r\n\r\n\r\n\r\n    function escapeName(name: string) {\r\n        const escaped = escapeIdentifier(name);\r\n\r\n        if (!takenNames[escaped]) {\r\n            takenNames[escaped] = true;\r\n            return escaped;\r\n        }\r\n\r\n        let index = 2;\r\n        while (takenNames[escaped + index]) {\r\n            index++;\r\n        }\r\n\r\n        takenNames[escaped + index] = true;\r\n        return escaped + index;\r\n    }\r\n}\r\n\r\nexport async function downloadTypeScriptAsync(name: string, assets: AssetInfo[]) {\r\n    let assetTS = \"\";\r\n\r\n    let takenNames: {[index: string]: boolean} = {};\r\n\r\n    for (const asset of assets) {\r\n        assetTS += `const ${escapeName(asset.name)} = ${imgEncodeJRESImage(asset.jres)};\\n`\r\n    }\r\n\r\n    return browserDownloadText(assetTS, name + \".ts\");\r\n\r\n    function escapeName(name: string) {\r\n        const escaped = escapeIdentifier(name);\r\n\r\n        if (!takenNames[escaped]) {\r\n            takenNames[escaped] = true;\r\n            return escaped;\r\n        }\r\n\r\n        let index = 2;\r\n        while (takenNames[escaped + index]) {\r\n            index++;\r\n        }\r\n\r\n        takenNames[escaped + index] = true;\r\n        return escaped + index;\r\n    }\r\n}","\r\n// @ts-ignore\r\nimport * as LZMA from \"../node_modules/lzma/src/lzma_worker-min\";\r\n\r\nexport function lzmaCompressAsync(text: string) {\r\n    const lzma = LZMA.LZMA;\r\n\r\n    return new Promise<Uint8Array>((resolve, reject) => {\r\n        try {\r\n            lzma.compress(text, 7, (res: any, error: any) => {\r\n                if (error) reject(error);\r\n                else resolve(new Uint8Array(res));\r\n            });\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\nexport function lzmaDecompressAsync(data: Uint8Array) {\r\n    const lzma = LZMA.LZMA;\r\n\r\n    return new Promise<string>((resolve, reject) => {\r\n        try {\r\n            lzma.decompress(data, (res: string, error: any) => {\r\n                if (error) reject(error);\r\n                else resolve(res);\r\n            });\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}","import React from 'react';\r\nimport { Alert, AlertProps } from './Alert';\r\nimport { Asset, AssetInfo } from './Asset';\r\nimport { JRESImage, getJRESImageFromDataString } from '../images'\r\nimport { arcadePalette, fetchMakeCodeScriptAsync } from '../share';\r\nimport '../styles/AssetList.css';\r\nimport { downloadProjectAsync, downloadTypeScriptAsync } from '../export';\r\n\r\ninterface AlertInfo extends AlertProps {\r\n    type: \"delete\" | \"import\" | \"warning\" | \"export\";\r\n}\r\n\r\ninterface AssetListProps {\r\n    postMessage: (msg: any) => void;\r\n}\r\n\r\ninterface AssetListState {\r\n    items: AssetInfo[];\r\n    selected: number;\r\n    saving?: number;\r\n    alert?: AlertInfo;\r\n}\r\n\r\nconst DEFAULT_NAME = \"mySprite\";\r\nconst DEFAULT_JRES = {\r\n    data: \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\r\n    previewURI: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAH0lEQVQ4T2NkoBAwUqifYdQAhtEwYBgNA1A+Gvi8AAAmmAARf9qcXAAAAABJRU5ErkJggg==\",\r\n    width: 16,\r\n    height: 16,\r\n}\r\n\r\nconst STORAGE_KEY = \"SPRITE_DATA\"\r\n\r\nclass AssetList extends React.Component<AssetListProps, AssetListState> {\r\n    private _items: AssetInfo[];\r\n    private _inputRef!: HTMLInputElement;\r\n\r\n    constructor(props: AssetListProps) {\r\n        super(props);\r\n\r\n        const storedJson = window.localStorage.getItem(STORAGE_KEY);\r\n        const storedItems = storedJson && JSON.parse(storedJson) as AssetInfo[];\r\n        this._items = storedItems || [{ name: DEFAULT_NAME, jres: { ...DEFAULT_JRES } }];\r\n\r\n        this.state = {\r\n            items: this._items,\r\n            selected: 0\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"message\", this.handleMessage);\r\n        this.loadJres(this._items[this.state.selected]);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"message\", this.handleMessage);\r\n        window.localStorage.setItem(STORAGE_KEY, JSON.stringify(this._items));\r\n    }\r\n\r\n    componentDidUpdate(prevProps: AssetListProps, prevState: AssetListState) {\r\n        if (this.state.saving !== undefined && prevState.saving === undefined) {\r\n            this.getJres();\r\n        }\r\n        if (this.state.selected !== prevState.selected || this.state.selected === 0) {\r\n            this.loadJres(this._items[this.state.selected]);\r\n        }\r\n        window.localStorage.setItem(STORAGE_KEY, JSON.stringify(this._items));\r\n    }\r\n\r\n    handleMessage = (msg: any) => {\r\n        const data = msg.data;\r\n        switch (data.type) {\r\n            case \"ready\":\r\n                this.loadJres(this._items[this.state.selected]);\r\n                break;\r\n            case \"update\":\r\n                const jresImage = getJRESImageFromDataString(data.message, arcadePalette);\r\n                if (this.state.saving !== undefined) {\r\n                    const saving = this.state.saving;\r\n                    this._items[this.state.selected].jres = jresImage;\r\n                    this.setState({\r\n                        items: this._items,\r\n                        selected: saving,\r\n                        saving: undefined\r\n                    });\r\n                } else {\r\n                    this._items[this.state.selected].jres = jresImage;\r\n                    this.setState({ items: this._items });\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    loadJres = (asset: AssetInfo) => {\r\n        this.props.postMessage({ type: \"initialize\", message: asset.jres.data });\r\n    }\r\n\r\n    getJres = () => {\r\n        this.props.postMessage({ type: \"update\" });\r\n    }\r\n\r\n    /** ASSET HANDLING */\r\n\r\n    addAsset(name?: string) {\r\n        this._items.push({\r\n            name: this.getValidAssetName(name || DEFAULT_NAME),\r\n            jres: { ...DEFAULT_JRES }\r\n        })\r\n        this.setState({\r\n            items: this._items,\r\n            saving: this._items.length - 1\r\n         });\r\n    }\r\n\r\n    deleteAsset(index: number) {\r\n        this._items.splice(index, 1);\r\n        this.setState({\r\n            items: this._items,\r\n            selected: Math.max(index - 1, 0)\r\n         })\r\n    }\r\n\r\n    renameAsset(index: number, newName: string) {\r\n        if (this._items[index].name !== newName) {\r\n            this._items[index].name = this.getValidAssetName(newName);\r\n            this.setState({ items: this._items });\r\n        }\r\n    }\r\n\r\n    importAssets(url: string, replace?: boolean) {\r\n        fetchMakeCodeScriptAsync(url).then((res: {projectImages: JRESImage[]}) => {\r\n            if (replace) this._items = [];\r\n            res.projectImages.forEach((el: JRESImage) => {\r\n                this._items.push({ name: el.qualifiedName || this.getValidAssetName(DEFAULT_NAME), jres: el })\r\n            } )\r\n            this.setState({items: this._items})\r\n        })\r\n    }\r\n\r\n    getAssetIndex(name: string): number {\r\n        return this._items.findIndex((el) => el.name.toLowerCase() === name.toLowerCase());\r\n    }\r\n\r\n    getValidAssetName(name: string): string {\r\n        name = name.replace(/[^a-zA-Z0-9]/g, '');\r\n        while (this.getAssetIndex(name) >= 0) {\r\n            let r = name.match(/^(.*?)(\\d+)$/);\r\n            // increment counter by one\r\n            name = r ? r[1] + (parseInt(r[2], 10) + 1) : name + \"2\";\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /** ASSET EVENT LISTENERS */\r\n\r\n    onAssetClick = (index: number): (e: any) => void => {\r\n        return () => {\r\n            this.setState({ saving: index });\r\n        }\r\n    }\r\n\r\n    onAssetRename = (index: number): (name: string) => void => {\r\n        return (name: string) => { this.renameAsset(index, name) };\r\n    }\r\n\r\n    onAddButtonClick = () => {\r\n        this.addAsset(DEFAULT_NAME);\r\n    }\r\n\r\n    onDeleteButtonClick = () => {\r\n        if (this._items.length > 1) {\r\n            this.setState({\r\n                alert: {\r\n                    type: \"delete\",\r\n                    icon: \"exclamation triangle\",\r\n                    title: \"Warning!\",\r\n                    text: \"Deleting an image is permanent. You will not be able to undo this action.\",\r\n                    options: [{\r\n                            text: \"Delete\",\r\n                            onClick: () => {\r\n                                this.deleteAsset(this.state.selected);\r\n                                this.hideAlert();\r\n                            }\r\n                        }]\r\n                }\r\n            })\r\n        } else {\r\n            this.setState({\r\n                alert: {\r\n                    type: \"warning\",\r\n                    icon: \"ban\",\r\n                    title: \"Unable to delete\",\r\n                    text: \"You must have at least one image in your project.\",\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    onImportButtonClick = () => {\r\n        this.setState({\r\n            alert: {\r\n                type: \"import\",\r\n                icon: \"upload\",\r\n                title: \"Import Sprites\",\r\n                text: \"Paste the URL to a shared game from MakeCode Arcade to import sprites from an existing project.\",\r\n                options: [{\r\n                        text: \"Import\",\r\n                        onClick: () => {\r\n                            this.importAssets(this._inputRef.value);\r\n                            this.hideAlert();\r\n                        }\r\n                    }]\r\n            }\r\n        })\r\n    }\r\n\r\n    onExportButtonClick = () => {\r\n        // ensure we have most updated sprites\r\n        this.getJres();\r\n        this.setState({\r\n            alert: {\r\n                type: \"export\",\r\n                icon: \"download\",\r\n                title: \"Export Sprite Pack\",\r\n                text: \"Export your sprites as an .mckd project to load directly into Arcade, or as a .ts file with your images encoded.\",\r\n                options: [{\r\n                        text: \"Download MKCD\",\r\n                        onClick: () => {\r\n                            // download as MKCD\r\n                            this.hideAlert();\r\n                            downloadProjectAsync(\"project\", this.state.items);\r\n                        }\r\n                    },\r\n                    {\r\n                        text: \"Download TS\",\r\n                        onClick: () => {\r\n                            // download as TS\r\n                            this.hideAlert();\r\n                            downloadTypeScriptAsync(\"project\", this.state.items);\r\n                        }\r\n                    }]\r\n            }\r\n        })\r\n    }\r\n\r\n    hideAlert = () => {\r\n        this.setState({ alert: undefined });\r\n    }\r\n\r\n    handleInputRef = (el: HTMLInputElement) => {\r\n        this._inputRef = el;\r\n    }\r\n\r\n    render() {\r\n        const { items, selected, alert } = this.state;\r\n\r\n        return <div id=\"asset-list\">\r\n            {alert && <Alert icon={alert.icon} title={alert.title} text={alert.text} options={alert.options} visible={true} onClose={this.hideAlert}>\r\n                {alert.type === \"import\" && <input className=\"asset-import\" ref={this.handleInputRef} placeholder=\"https://makecode.com/_r8fboJQTDPtH or https://arcade.makeode.com/62736-71128-62577-28722\" />}\r\n            </Alert>}\r\n            <div className=\"asset-list-buttons\">\r\n                <div className=\"asset-button\" title=\"Add asset\" onClick={this.onAddButtonClick}>\r\n                    <i className=\"icon plus square outline\"></i>\r\n                </div>\r\n                <div className=\"asset-button\" title=\"Import assets\" onClick={this.onImportButtonClick}>\r\n                    <i className=\"icon upload\"></i>\r\n                </div>\r\n                <div className=\"asset-button\" title=\"Export assets\" onClick={this.onExportButtonClick}>\r\n                    <i className=\"icon download\"></i>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                { items.map((item, i) => {\r\n                    return <Asset\r\n                        key={i}\r\n                        info={item}\r\n                        selected={i === selected}\r\n                        onClick={this.onAssetClick(i)}\r\n                        onRename={this.onAssetRename(i)}\r\n                        onDelete={this.onDeleteButtonClick} />\r\n                }) }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default AssetList","import React from 'react';\r\nimport AssetList from './components/AssetList';\r\nimport './styles/App.css';\r\n\r\nclass App extends React.Component {\r\n    private iframe!: HTMLIFrameElement;\r\n    componentDidMount() {\r\n        this.iframe = document.getElementById(\"editor\") as HTMLIFrameElement;\r\n    }\r\n\r\n    postMessage = (data: any) => {\r\n        if (this.iframe && this.iframe.contentWindow) {\r\n            data[\"_fromVscode\"] = true; // fake _fromVscode for now\r\n            this.iframe.contentWindow.postMessage(data, \"*\");\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"app\">\r\n                <iframe id=\"editor\" title=\"MakeCode Arcade sprite editor\" src=\"https://arcade.makecode.com/beta--asseteditor\" />\r\n                <AssetList postMessage={this.postMessage} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './styles/index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}